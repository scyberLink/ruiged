"use strict";
/* eslint-disable require-jsdoc */
Object.defineProperty(exports, "__esModule", { value: true });
exports.StorageType = void 0;
const constants_1 = require("./constants");
var StorageType;
(function (StorageType) {
    StorageType[StorageType["MEMORY_STORAGE"] = 0] = "MEMORY_STORAGE";
    StorageType[StorageType["LOCAL_STORAGE"] = 1] = "LOCAL_STORAGE";
    StorageType[StorageType["SESSION_STORAGE"] = 2] = "SESSION_STORAGE";
    StorageType[StorageType["DESTROY_ALL"] = 3] = "DESTROY_ALL";
})(StorageType = exports.StorageType || (exports.StorageType = {}));
class GlobalConfig {
    constructor() {
        if (!GlobalConfig._instance) {
            GlobalConfig._instance = this;
            this.dynamicConfig = {};
            Object.freeze(GlobalConfig);
            Object.seal(GlobalConfig);
            this.__get = (key, where) => {
                try {
                    key = btoa(key);
                }
                catch (_err) {
                    /* empty */
                }
                let value;
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        value = localStorage.getItem(key);
                        value = GlobalConfig.parse(value);
                        break;
                    case StorageType.SESSION_STORAGE:
                        value = sessionStorage.getItem(key);
                        value = GlobalConfig.parse(value);
                        break;
                    default:
                        value = this.dynamicConfig[key];
                        break;
                }
                return value;
            };
            const switchSet = (key, value, where) => {
                try {
                    key = btoa(key);
                }
                catch (_err) {
                    /* empty */
                }
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        value = GlobalConfig.stringify(value);
                        localStorage.setItem(key, value);
                        break;
                    case StorageType.SESSION_STORAGE:
                        value = GlobalConfig.stringify(value);
                        sessionStorage.setItem(key, value);
                        break;
                    default:
                        this.dynamicConfig[key] = value;
                        break;
                }
            };
            this.__set = (key, value, where) => {
                if (key instanceof Object) {
                    let configKey;
                    let configObj;
                    if (key instanceof Array && value instanceof Array) {
                        configKey = key;
                        configObj = value;
                    }
                    else {
                        configKey = Object.keys(key);
                        configObj = Object.values(key);
                    }
                    for (let i = 0; i < configKey.length; i++) {
                        const k = configKey[i];
                        const v = configObj[i];
                        if (k) {
                            switchSet(k, v, where);
                        }
                    }
                }
                else {
                    if (key) {
                        switchSet(key, value, where);
                    }
                }
            };
            this.__remove = (key, where) => {
                let { key: copiedKey } = { key };
                try {
                    copiedKey = btoa(copiedKey);
                }
                catch (_err) {
                    /* empty */
                }
                let value;
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        value = this.__get(key, StorageType.LOCAL_STORAGE);
                        if (value)
                            localStorage.removeItem(copiedKey);
                        break;
                    case StorageType.SESSION_STORAGE:
                        value = this.__get(key, StorageType.SESSION_STORAGE);
                        if (value)
                            sessionStorage.removeItem(copiedKey);
                        break;
                    default:
                        value = this.__get(key, StorageType.MEMORY_STORAGE);
                        if (value)
                            delete this.dynamicConfig[copiedKey];
                        break;
                }
                return value;
            };
            this.__destroy = (where) => {
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        localStorage.clear();
                        break;
                    case StorageType.SESSION_STORAGE:
                        sessionStorage.clear();
                        break;
                    case StorageType.DESTROY_ALL:
                        this.dynamicConfig = {};
                        localStorage.clear();
                        sessionStorage.clear();
                        break;
                    default:
                        this.dynamicConfig = {};
                        break;
                }
            };
            this.__removeFrom = (fromKey, valueToRemove, where = StorageType.MEMORY_STORAGE) => {
                const exist = this.__get(fromKey, where);
                if (!exist)
                    return false;
                if (exist instanceof Array) {
                    let deleted;
                    if (!valueToRemove) {
                        deleted = exist.pop();
                    }
                    else {
                        const [deleted_temp] = [...exist[exist.indexOf(valueToRemove)]];
                        delete exist[exist.indexOf(valueToRemove)];
                        deleted = deleted_temp;
                    }
                    if (deleted) {
                        this.__set(fromKey, exist, where);
                    }
                    return deleted;
                }
                return false;
            };
            this.__removeFromObject = (fromKey, keyToRemove, where = StorageType.MEMORY_STORAGE) => {
                const exist = this.__get(fromKey, where);
                if (!exist)
                    return false;
                if (!(exist instanceof Array)) {
                    const tempName = `${keyToRemove}_temp`;
                    const { [tempName]: temp } = { [tempName]: exist[keyToRemove] };
                    delete exist[keyToRemove];
                    const deleted = temp;
                    if (deleted) {
                        this.__set(fromKey, exist, where);
                    }
                    return deleted;
                }
                return false;
            };
            this.__has = (key, where) => {
                const exist = this.__get(key, where);
                return !!exist;
            };
        }
        return GlobalConfig._instance;
    }
    get(key) {
        return this.__get(key, StorageType.MEMORY_STORAGE);
    }
    set(key, value) {
        this.__set(key, value, StorageType.MEMORY_STORAGE);
    }
    addTo(parentKey, valueToAdd) {
        if (!Object.hasOwnProperty.call(this.dynamicConfig, parentKey)) {
            this.dynamicConfig[parentKey] = [];
        }
        if (!(this.dynamicConfig[parentKey] instanceof Array)) {
            this.dynamicConfig[parentKey] = [this.dynamicConfig[parentKey]];
        }
        this.dynamicConfig[parentKey].push(valueToAdd);
        return this.dynamicConfig[parentKey];
    }
    addToFlashData(parentKey, valueToAdd) {
        return this.addToLocalData(parentKey, valueToAdd);
    }
    addToLocalData(parentKey, valueToAdd) {
        let exist = this.__get(parentKey, StorageType.LOCAL_STORAGE);
        if (!exist)
            exist = [];
        if (!(exist instanceof Array)) {
            exist = [exist];
        }
        exist.push(valueToAdd);
        this.__set(parentKey, exist, StorageType.LOCAL_STORAGE);
        return exist;
    }
    addToSessionData(parentKey, valueToAdd) {
        let exist = this.__get(parentKey, StorageType.SESSION_STORAGE);
        if (!exist)
            exist = [];
        if (!(exist instanceof Array)) {
            exist = [exist];
        }
        exist.push(valueToAdd);
        this.__set(parentKey, exist, StorageType.SESSION_STORAGE);
        return exist;
    }
    removeFrom(parentKey, valueToRemove) {
        return this.__removeFrom(parentKey, valueToRemove, StorageType.MEMORY_STORAGE);
    }
    removeFromFlashData(parentKey, valueToRemove) {
        return this.removeFromLocalData(parentKey, valueToRemove);
    }
    removeFromLocalData(parentKey, valueToRemove) {
        return this.__removeFrom(parentKey, valueToRemove, StorageType.LOCAL_STORAGE);
    }
    removeFromSessionData(parentKey, valueToRemove) {
        return this.__removeFrom(parentKey, valueToRemove, StorageType.SESSION_STORAGE);
    }
    addToObject(parentKey, key, value) {
        if (!Object.hasOwnProperty.call(this.dynamicConfig, parentKey)) {
            this.dynamicConfig[parentKey] = {};
        }
        if (typeof this.dynamicConfig[parentKey] == 'string' ||
            typeof this.dynamicConfig[parentKey] == 'number' ||
            typeof this.dynamicConfig[parentKey] == 'boolean') {
            this.dynamicConfig[parentKey] = { [constants_1.SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX]: this.dynamicConfig[parentKey] };
        }
        this.dynamicConfig[parentKey][key] = value;
        return this.dynamicConfig[parentKey];
    }
    addToObjectFlashData(parentKey, key, value) {
        return this.addToObjectLocalData(parentKey, key, value);
    }
    addToObjectLocalData(parentKey, key, value) {
        let exist = this.__get(parentKey, StorageType.LOCAL_STORAGE);
        if (!exist)
            exist = {};
        if (typeof exist == 'string' || typeof exist == 'number' || typeof exist == 'boolean') {
            exist = { [constants_1.SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX]: exist };
        }
        exist[key] = value;
        this.__set(parentKey, exist, StorageType.LOCAL_STORAGE);
        return exist;
    }
    addToObjectSessionData(parentKey, key, value) {
        let exist = this.__get(parentKey, StorageType.SESSION_STORAGE);
        if (!exist)
            exist = {};
        if (typeof exist == 'string' || typeof exist == 'number' || typeof exist == 'boolean') {
            exist = { [constants_1.SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX]: exist };
        }
        exist[key] = value;
        this.__set(parentKey, exist, StorageType.SESSION_STORAGE);
        return exist;
    }
    removeFromObject(parentKey, keyToRemove) {
        return this.__removeFromObject(parentKey, keyToRemove, StorageType.MEMORY_STORAGE);
    }
    removeFromObjectFlashData(parentKey, keyToRemove) {
        return this.removeFromObjectLocalData(parentKey, keyToRemove);
    }
    removeFromObjectLocalData(parentKey, keyToRemove) {
        return this.__removeFromObject(parentKey, keyToRemove, StorageType.LOCAL_STORAGE);
    }
    removeFromObjectSessionData(parentKey, keyToRemove) {
        return this.__removeFromObject(parentKey, keyToRemove, StorageType.SESSION_STORAGE);
    }
    getFlashData(key) {
        return this.__remove(key, StorageType.LOCAL_STORAGE);
    }
    setFlashData(key, value) {
        this.setLocalData(key, value);
    }
    getLocalData(key) {
        return this.__get(key, StorageType.LOCAL_STORAGE);
    }
    setLocalData(key, value) {
        this.__set(key, value, StorageType.LOCAL_STORAGE);
    }
    getSessionData(key) {
        return this.__get(key, StorageType.SESSION_STORAGE);
    }
    setSessionData(key, value) {
        this.__set(key, value, StorageType.SESSION_STORAGE);
    }
    has(key) {
        return this.__has(key, StorageType.MEMORY_STORAGE);
    }
    isFlashData(key) {
        return this.isLocalData(key);
    }
    isLocalData(key) {
        return this.__has(key, StorageType.LOCAL_STORAGE);
    }
    isSessionData(key) {
        return this.__has(key, StorageType.SESSION_STORAGE);
    }
    remove(key) {
        return this.__remove(key, StorageType.MEMORY_STORAGE);
    }
    removeSessionData(key) {
        return this.__remove(key, StorageType.SESSION_STORAGE);
    }
    removeLocalData(key) {
        return this.__remove(key, StorageType.LOCAL_STORAGE);
    }
    removeFlashData(key) {
        return this.removeLocalData(key);
    }
    destroy() {
        this.__destroy(StorageType.MEMORY_STORAGE);
    }
    destroyLocalData() {
        this.__destroy(StorageType.LOCAL_STORAGE);
    }
    destroySessionData() {
        this.__destroy(StorageType.SESSION_STORAGE);
    }
    destroyAll() {
        this.__destroy(StorageType.DESTROY_ALL);
    }
    increment(key, throwIfNotfound = false) {
        if (Object.hasOwnProperty.call(this.dynamicConfig, key)) {
            if (typeof Number.parseInt(this.dynamicConfig[key]) === 'number') {
                ++this.dynamicConfig[key];
                return this.dynamicConfig[key];
            }
            else {
                throw new Error("Specified key is not a number can't increment");
            }
        }
        else {
            if (throwIfNotfound)
                throw new Error('Key not found');
        }
        return (this.dynamicConfig[key] = 1);
    }
    decrement(key, throwIfNotfound = false) {
        if (Object.hasOwnProperty.call(this.dynamicConfig, key)) {
            if (typeof Number.parseInt(this.dynamicConfig[key]) === 'number') {
                --this.dynamicConfig[key];
                return this.dynamicConfig[key];
            }
            else {
                throw new Error("Specified key is not a number can't decrement");
            }
        }
        else {
            if (throwIfNotfound)
                throw new Error('Key not found');
        }
        return (this.dynamicConfig[key] = -1);
    }
}
GlobalConfig.parse = (value) => {
    if (value) {
        try {
            value = atob(value);
        }
        catch (_err) {
            /* empty */
        }
        try {
            value = JSON.parse(value);
        }
        catch (error) {
            /* empty */
        }
    }
    return value;
};
GlobalConfig.stringify = (value) => {
    try {
        if (value instanceof Object) {
            value = JSON.stringify(value);
        }
    }
    catch (_err) {
        /* empty */
    }
    try {
        value = btoa(value);
    }
    catch (_err) {
        /* empty */
    }
    return value;
};
const SharedConfig = new GlobalConfig();
exports.default = SharedConfig;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2hhcmVkQ29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vcnVpZy9zcmMvY29tbW9uL1NoYXJlZENvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsa0NBQWtDOzs7QUFFbEMsMkNBQW9FO0FBR3BFLElBQWtCLFdBS2pCO0FBTEQsV0FBa0IsV0FBVztJQUMzQixpRUFBYyxDQUFBO0lBQ2QsK0RBQWEsQ0FBQTtJQUNiLG1FQUFlLENBQUE7SUFDZiwyREFBVyxDQUFBO0FBQ2IsQ0FBQyxFQUxpQixXQUFXLEdBQVgsbUJBQVcsS0FBWCxtQkFBVyxRQUs1QjtBQUVELE1BQU0sWUFBWTtJQWlCaEI7UUFDRSxJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRTtZQUMzQixZQUFZLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQTtZQUM3QixJQUFJLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQTtZQUN2QixNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFBO1lBQzNCLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUE7WUFFekIsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFrQixFQUFFLEVBQUU7Z0JBQ3ZDLElBQUk7b0JBQ0YsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtpQkFDaEI7Z0JBQUMsT0FBTyxJQUFJLEVBQUU7b0JBQ2IsV0FBVztpQkFDWjtnQkFFRCxJQUFJLEtBQW9CLENBQUE7Z0JBRXhCLFFBQVEsS0FBSyxFQUFFO29CQUNiLEtBQUssV0FBVyxDQUFDLGFBQWE7d0JBQzVCLEtBQUssR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFBO3dCQUNqQyxLQUFLLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTt3QkFDakMsTUFBSztvQkFFUCxLQUFLLFdBQVcsQ0FBQyxlQUFlO3dCQUM5QixLQUFLLEdBQUcs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QUNqRTtTQUNGO2FBQU07WUFDTCxJQUFJLGVBQWU7Z0JBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQTtTQUN0RDtRQUNELE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDdkMsQ0FBQzs7QUFFTSxrQkFBSyxHQUFHLENBQUMsS0FBb0IsRUFBRSxFQUFFO0lBQ3RDLElBQUksS0FBSyxFQUFFO1FBQ1QsSUFBSTtZQUNGLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDcEI7UUFBQyxPQUFPLElBQUksRUFBRTtZQUNiLFdBQVc7U0FDWjtRQUNELElBQUk7WUFDRixLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtTQUMxQjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsV0FBVztTQUNaO0tBQ0Y7SUFDRCxPQUFPLEtBQUssQ0FBQTtBQUNkLENBQUMsQ0FBQTtBQUVNLHNCQUFTLEdBQUcsQ0FBQyxLQUEwQixFQUFFLEVBQUU7SUFDaEQsSUFBSTtRQUNGLElBQUksS0FBSyxZQUFZLE1BQU0sRUFBRTtZQUMzQixLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQTtTQUM5QjtLQUNGO0lBQUMsT0FBTyxJQUFJLEVBQUU7UUFDYixXQUFXO0tBQ1o7SUFFRCxJQUFJO1FBQ0YsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFlLENBQUMsQ0FBQTtLQUM5QjtJQUFDLE9BQU8sSUFBSSxFQUFFO1FBQ2IsV0FBVztLQUNaO0lBRUQsT0FBTyxLQUFLLENBQUE7QUFDZCxDQUFDLENBQUE7QUFHSCxNQUFNLFlBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFBO0FBRXZDLGtCQUFlLFlBQVksQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIHJlcXVpcmUtanNkb2MgKi9cblxuaW1wb3J0IHsgU0hBUkVEQ09ORklHX0FERFRPT0JKRUNUX0lOSVRJQUxfSU5ERVggfSBmcm9tICcuL2NvbnN0YW50cydcbmltcG9ydCBJQW55T2JqZWN0IGZyb20gJy4vbW9kZWxzL0lBbnlPYmplY3QnXG5cbmV4cG9ydCBjb25zdCBlbnVtIFN0b3JhZ2VUeXBlIHtcbiAgTUVNT1JZX1NUT1JBR0UsXG4gIExPQ0FMX1NUT1JBR0UsXG4gIFNFU1NJT05fU1RPUkFHRSxcbiAgREVTVFJPWV9BTEwsXG59XG5cbmNsYXNzIEdsb2JhbENvbmZpZyB7XG4gIHByb3RlY3RlZCBzdGF0aWMgX2luc3RhbmNlOiBHbG9iYWxDb25maWdcblxuICBwcml2YXRlIGR5bmFtaWNDb25maWchOiBJQW55T2JqZWN0XG4gIHByaXZhdGUgX19nZXQhOiAoa2V5OiBzdHJpbmcsIHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4gSUFueU9iamVjdCB8IHN0cmluZyB8IG51bGxcbiAgcHJpdmF0ZSBfX3NldCE6IChrZXk6IHN0cmluZyB8IElBbnlPYmplY3QsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0LCB3aGVyZTogU3RvcmFnZVR5cGUpID0+IHZvaWRcbiAgcHJpdmF0ZSBfX3JlbW92ZSE6IChrZXk6IHN0cmluZywgd2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiBJQW55T2JqZWN0IHwgc3RyaW5nIHwgbnVsbFxuICBwcml2YXRlIF9fZGVzdHJveSE6ICh3aGVyZTogU3RvcmFnZVR5cGUpID0+IHZvaWRcbiAgcHJpdmF0ZSBfX3JlbW92ZUZyb20hOiAoXG4gICAgZnJvbUtleTogc3RyaW5nLFxuICAgIHZhbHVlVG9SZW1vdmU/OiBJQW55T2JqZWN0IHwgc3RyaW5nLFxuICAgIHdoZXJlPzogU3RvcmFnZVR5cGUsXG4gICkgPT4gSUFueU9iamVjdCB8IHN0cmluZyB8IG51bGxcbiAgcHJpdmF0ZSBfX2hhcyE6IChrZXk6IHN0cmluZywgd2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiBib29sZWFuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIHByaXZhdGUgX19yZW1vdmVGcm9tT2JqZWN0ITogKGZyb21LZXk6IHN0cmluZywga2V5VG9SZW1vdmU6IHN0cmluZywgd2hlcmU/OiBTdG9yYWdlVHlwZSkgPT4gYW55XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgaWYgKCFHbG9iYWxDb25maWcuX2luc3RhbmNlKSB7XG4gICAgICBHbG9iYWxDb25maWcuX2luc3RhbmNlID0gdGhpc1xuICAgICAgdGhpcy5keW5hbWljQ29uZmlnID0ge31cbiAgICAgIE9iamVjdC5mcmVlemUoR2xvYmFsQ29uZmlnKVxuICAgICAgT2JqZWN0LnNlYWwoR2xvYmFsQ29uZmlnKVxuXG4gICAgICB0aGlzLl9fZ2V0ID0gKGtleSwgd2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAga2V5ID0gYnRvYShrZXkpXG4gICAgICAgIH0gY2F0Y2ggKF9lcnIpIHtcbiAgICAgICAgICAvKiBlbXB0eSAqL1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHZhbHVlOiBzdHJpbmcgfCBudWxsXG5cbiAgICAgICAgc3dpdGNoICh3aGVyZSkge1xuICAgICAgICAgIGNhc2UgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRTpcbiAgICAgICAgICAgIHZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KVxuICAgICAgICAgICAgdmFsdWUgPSBHbG9iYWxDb25maWcucGFyc2UodmFsdWUpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgY2FzZSBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0U6XG4gICAgICAgICAgICB2YWx1ZSA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oa2V5KVxuICAgICAgICAgICAgdmFsdWUgPSBHbG9iYWxDb25maWcucGFyc2UodmFsdWUpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5keW5hbWljQ29uZmlnW2tleV1cbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsdWVcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3dpdGNoU2V0ID0gKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCwgd2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAga2V5ID0gYnRvYShrZXkpXG4gICAgICAgIH0gY2F0Y2ggKF9lcnIpIHtcbiAgICAgICAgICAvKiBlbXB0eSAqL1xuICAgICAgICB9XG5cbiAgICAgICAgc3dpdGNoICh3aGVyZSkge1xuICAgICAgICAgIGNhc2UgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRTpcbiAgICAgICAgICAgIHZhbHVlID0gR2xvYmFsQ29uZmlnLnN0cmluZ2lmeSh2YWx1ZSlcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUgYXMgc3RyaW5nKVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgIGNhc2UgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFOlxuICAgICAgICAgICAgdmFsdWUgPSBHbG9iYWxDb25maWcuc3RyaW5naWZ5KHZhbHVlKVxuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlIGFzIHN0cmluZylcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhpcy5keW5hbWljQ29uZmlnW2tleV0gPSB2YWx1ZVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLl9fc2V0ID0gKGtleTogc3RyaW5nIHwgSUFueU9iamVjdCwgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QsIHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4ge1xuICAgICAgICBpZiAoa2V5IGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgICAgbGV0IGNvbmZpZ0tleVxuICAgICAgICAgIGxldCBjb25maWdPYmpcbiAgICAgICAgICBpZiAoa2V5IGluc3RhbmNlb2YgQXJyYXkgJiYgdmFsdWUgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgY29uZmlnS2V5ID0ga2V5XG4gICAgICAgICAgICBjb25maWdPYmogPSB2YWx1ZVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25maWdLZXkgPSBPYmplY3Qua2V5cyhrZXkpXG4gICAgICAgICAgICBjb25maWdPYmogPSBPYmplY3QudmFsdWVzKGtleSlcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb25maWdLZXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGsgPSBjb25maWdLZXlbaV1cbiAgICAgICAgICAgIGNvbnN0IHYgPSBjb25maWdPYmpbaV1cbiAgICAgICAgICAgIGlmIChrKSB7XG4gICAgICAgICAgICAgIHN3aXRjaFNldChrLCB2LCB3aGVyZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgc3dpdGNoU2V0KGtleSwgdmFsdWUsIHdoZXJlKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLl9fcmVtb3ZlID0gKGtleTogc3RyaW5nLCB3aGVyZTogU3RvcmFnZVR5cGUpID0+IHtcbiAgICAgICAgbGV0IHsga2V5OiBjb3BpZWRLZXkgfSA9IHsga2V5IH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvcGllZEtleSA9IGJ0b2EoY29waWVkS2V5KVxuICAgICAgICB9IGNhdGNoIChfZXJyKSB7XG4gICAgICAgICAgLyogZW1wdHkgKi9cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB2YWx1ZVxuXG4gICAgICAgIHN3aXRjaCAod2hlcmUpIHtcbiAgICAgICAgICBjYXNlIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0U6XG4gICAgICAgICAgICB2YWx1ZSA9IHRoaXMuX19nZXQoa2V5LCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICAgICAgICAgICAgaWYgKHZhbHVlKSBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShjb3BpZWRLZXkpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgY2FzZSBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0U6XG4gICAgICAgICAgICB2YWx1ZSA9IHRoaXMuX19nZXQoa2V5LCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gICAgICAgICAgICBpZiAodmFsdWUpIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oY29waWVkS2V5KVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB2YWx1ZSA9IHRoaXMuX19nZXQoa2V5LCBTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSlcbiAgICAgICAgICAgIGlmICh2YWx1ZSkgZGVsZXRlIHRoaXMuZHluYW1pY0NvbmZpZ1tjb3BpZWRLZXldXG4gICAgICAgICAgICBicmVha1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlXG4gICAgICB9XG5cbiAgICAgIHRoaXMuX19kZXN0cm95ID0gKHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4ge1xuICAgICAgICBzd2l0Y2ggKHdoZXJlKSB7XG4gICAgICAgICAgY2FzZSBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFOlxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmNsZWFyKClcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBjYXNlIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRTpcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLmNsZWFyKClcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBjYXNlIFN0b3JhZ2VUeXBlLkRFU1RST1lfQUxMOlxuICAgICAgICAgICAgdGhpcy5keW5hbWljQ29uZmlnID0ge31cbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5jbGVhcigpXG4gICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5jbGVhcigpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY0NvbmZpZyA9IHt9XG4gICAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX19yZW1vdmVGcm9tID0gKFxuICAgICAgICBmcm9tS2V5LFxuICAgICAgICB2YWx1ZVRvUmVtb3ZlPzogSUFueU9iamVjdCB8IHN0cmluZyxcbiAgICAgICAgd2hlcmU6IFN0b3JhZ2VUeXBlID0gU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UsXG4gICAgICApID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3QgPSB0aGlzLl9fZ2V0KGZyb21LZXksIHdoZXJlKVxuICAgICAgICBpZiAoIWV4aXN0KSByZXR1cm4gZmFsc2VcbiAgICAgICAgaWYgKGV4aXN0IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICBsZXQgZGVsZXRlZFxuICAgICAgICAgIGlmICghdmFsdWVUb1JlbW92ZSkge1xuICAgICAgICAgICAgZGVsZXRlZCA9IGV4aXN0LnBvcCgpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IFtkZWxldGVkX3RlbXBdID0gWy4uLmV4aXN0W2V4aXN0LmluZGV4T2YodmFsdWVUb1JlbW92ZSldXVxuICAgICAgICAgICAgZGVsZXRlIGV4aXN0W2V4aXN0LmluZGV4T2YodmFsdWVUb1JlbW92ZSldXG4gICAgICAgICAgICBkZWxldGVkID0gZGVsZXRlZF90ZW1wXG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChkZWxldGVkKSB7XG4gICAgICAgICAgICB0aGlzLl9fc2V0KGZyb21LZXksIGV4aXN0LCB3aGVyZSlcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGRlbGV0ZWRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cblxuICAgICAgdGhpcy5fX3JlbW92ZUZyb21PYmplY3QgPSAoXG4gICAgICAgIGZyb21LZXk6IHN0cmluZyxcbiAgICAgICAga2V5VG9SZW1vdmU6IHN0cmluZyxcbiAgICAgICAgd2hlcmU6IFN0b3JhZ2VUeXBlID0gU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UsXG4gICAgICApID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3Q6IElBbnlPYmplY3QgPSB0aGlzLl9fZ2V0KGZyb21LZXksIHdoZXJlKSBhcyBJQW55T2JqZWN0XG4gICAgICAgIGlmICghZXhpc3QpIHJldHVybiBmYWxzZVxuICAgICAgICBpZiAoIShleGlzdCBpbnN0YW5jZW9mIEFycmF5KSkge1xuICAgICAgICAgIGNvbnN0IHRlbXBOYW1lID0gYCR7a2V5VG9SZW1vdmV9X3RlbXBgXG4gICAgICAgICAgY29uc3QgeyBbdGVtcE5hbWVdOiB0ZW1wIH0gPSB7IFt0ZW1wTmFtZV06IGV4aXN0W2tleVRvUmVtb3ZlXSB9XG4gICAgICAgICAgZGVsZXRlIGV4aXN0W2tleVRvUmVtb3ZlXVxuICAgICAgICAgIGNvbnN0IGRlbGV0ZWQgPSB0ZW1wXG5cbiAgICAgICAgICBpZiAoZGVsZXRlZCkge1xuICAgICAgICAgICAgdGhpcy5fX3NldChmcm9tS2V5LCBleGlzdCwgd2hlcmUpXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBkZWxldGVkXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIHRoaXMuX19oYXMgPSAoa2V5LCB3aGVyZTogU3RvcmFnZVR5cGUpID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3QgPSB0aGlzLl9fZ2V0KGtleSwgd2hlcmUpXG4gICAgICAgIHJldHVybiAhIWV4aXN0XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBHbG9iYWxDb25maWcuX2luc3RhbmNlXG4gIH1cblxuICBnZXQoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX2dldChrZXksIFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFKVxuICB9XG5cbiAgc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIHRoaXMuX19zZXQoa2V5LCB2YWx1ZSwgU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UpXG4gIH1cblxuICBhZGRUbyhwYXJlbnRLZXk6IHN0cmluZywgdmFsdWVUb0FkZDogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIGlmICghT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodGhpcy5keW5hbWljQ29uZmlnLCBwYXJlbnRLZXkpKSB7XG4gICAgICB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XSA9IFtdXG4gICAgfVxuICAgIGlmICghKHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldIGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XSA9IFt0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XV1cbiAgICB9XG4gICAgdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0ucHVzaCh2YWx1ZVRvQWRkKVxuICAgIHJldHVybiB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XVxuICB9XG5cbiAgYWRkVG9GbGFzaERhdGEocGFyZW50S2V5OiBzdHJpbmcsIHZhbHVlVG9BZGQ6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICByZXR1cm4gdGhpcy5hZGRUb0xvY2FsRGF0YShwYXJlbnRLZXksIHZhbHVlVG9BZGQpXG4gIH1cblxuICBhZGRUb0xvY2FsRGF0YShwYXJlbnRLZXk6IHN0cmluZywgdmFsdWVUb0FkZDogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIGxldCBleGlzdCA9IHRoaXMuX19nZXQocGFyZW50S2V5LCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICAgIGlmICghZXhpc3QpIGV4aXN0ID0gW11cbiAgICBpZiAoIShleGlzdCBpbnN0YW5jZW9mIEFycmF5KSkge1xuICAgICAgZXhpc3QgPSBbZXhpc3RdXG4gICAgfVxuICAgIGV4aXN0LnB1c2godmFsdWVUb0FkZClcbiAgICB0aGlzLl9fc2V0KHBhcmVudEtleSwgZXhpc3QsIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gICAgcmV0dXJuIGV4aXN0XG4gIH1cblxuICBhZGRUb1Nlc3Npb25EYXRhKHBhcmVudEtleTogc3RyaW5nLCB2YWx1ZVRvQWRkOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgbGV0IGV4aXN0ID0gdGhpcy5fX2dldChwYXJlbnRLZXksIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgICBpZiAoIWV4aXN0KSBleGlzdCA9IFtdXG4gICAgaWYgKCEoZXhpc3QgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgIGV4aXN0ID0gW2V4aXN0XVxuICAgIH1cbiAgICBleGlzdC5wdXNoKHZhbHVlVG9BZGQpXG4gICAgdGhpcy5fX3NldChwYXJlbnRLZXksIGV4aXN0LCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gICAgcmV0dXJuIGV4aXN0XG4gIH1cblxuICByZW1vdmVGcm9tKHBhcmVudEtleTogc3RyaW5nLCB2YWx1ZVRvUmVtb3ZlPzogSUFueU9iamVjdCB8IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlRnJvbShwYXJlbnRLZXksIHZhbHVlVG9SZW1vdmUsIFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFKVxuICB9XG5cbiAgcmVtb3ZlRnJvbUZsYXNoRGF0YShwYXJlbnRLZXk6IHN0cmluZywgdmFsdWVUb1JlbW92ZT86IElBbnlPYmplY3QgfCBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5yZW1vdmVGcm9tTG9jYWxEYXRhKHBhcmVudEtleSwgdmFsdWVUb1JlbW92ZSlcbiAgfVxuXG4gIHJlbW92ZUZyb21Mb2NhbERhdGEocGFyZW50S2V5OiBzdHJpbmcsIHZhbHVlVG9SZW1vdmU/OiBJQW55T2JqZWN0IHwgc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmVGcm9tKHBhcmVudEtleSwgdmFsdWVUb1JlbW92ZSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgfVxuXG4gIHJlbW92ZUZyb21TZXNzaW9uRGF0YShwYXJlbnRLZXk6IHN0cmluZywgdmFsdWVUb1JlbW92ZT86IElBbnlPYmplY3QgfCBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZUZyb20ocGFyZW50S2V5LCB2YWx1ZVRvUmVtb3ZlLCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gIH1cblxuICBhZGRUb09iamVjdChwYXJlbnRLZXk6IHN0cmluZywga2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgaWYgKCFPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmR5bmFtaWNDb25maWcsIHBhcmVudEtleSkpIHtcbiAgICAgIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldID0ge31cbiAgICB9XG4gICAgaWYgKFxuICAgICAgdHlwZW9mIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldID09ICdzdHJpbmcnIHx8XG4gICAgICB0eXBlb2YgdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0gPT0gJ251bWJlcicgfHxcbiAgICAgIHR5cGVvZiB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XSA9PSAnYm9vbGVhbidcbiAgICApIHtcbiAgICAgIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldID0geyBbU0hBUkVEQ09ORklHX0FERFRPT0JKRUNUX0lOSVRJQUxfSU5ERVhdOiB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XSB9XG4gICAgfVxuICAgIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldW2tleV0gPSB2YWx1ZVxuICAgIHJldHVybiB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XVxuICB9XG5cbiAgYWRkVG9PYmplY3RGbGFzaERhdGEocGFyZW50S2V5OiBzdHJpbmcsIGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIHJldHVybiB0aGlzLmFkZFRvT2JqZWN0TG9jYWxEYXRhKHBhcmVudEtleSwga2V5LCB2YWx1ZSlcbiAgfVxuXG4gIGFkZFRvT2JqZWN0TG9jYWxEYXRhKHBhcmVudEtleTogc3RyaW5nLCBrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICBsZXQgZXhpc3Q6IElBbnlPYmplY3QgPSB0aGlzLl9fZ2V0KHBhcmVudEtleSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSkgYXMgSUFueU9iamVjdFxuICAgIGlmICghZXhpc3QpIGV4aXN0ID0ge31cbiAgICBpZiAodHlwZW9mIGV4aXN0ID09ICdzdHJpbmcnIHx8IHR5cGVvZiBleGlzdCA9PSAnbnVtYmVyJyB8fCB0eXBlb2YgZXhpc3QgPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICBleGlzdCA9IHsgW1NIQVJFRENPTkZJR19BRERUT09CSkVDVF9JTklUSUFMX0lOREVYXTogZXhpc3QgfVxuICAgIH1cbiAgICBleGlzdFtrZXldID0gdmFsdWVcbiAgICB0aGlzLl9fc2V0KHBhcmVudEtleSwgZXhpc3QsIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gICAgcmV0dXJuIGV4aXN0XG4gIH1cblxuICBhZGRUb09iamVjdFNlc3Npb25EYXRhKHBhcmVudEtleTogc3RyaW5nLCBrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICBsZXQgZXhpc3Q6IElBbnlPYmplY3QgPSB0aGlzLl9fZ2V0KHBhcmVudEtleSwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKSBhcyBJQW55T2JqZWN0XG4gICAgaWYgKCFleGlzdCkgZXhpc3QgPSB7fVxuICAgIGlmICh0eXBlb2YgZXhpc3QgPT0gJ3N0cmluZycgfHwgdHlwZW9mIGV4aXN0ID09ICdudW1iZXInIHx8IHR5cGVvZiBleGlzdCA9PSAnYm9vbGVhbicpIHtcbiAgICAgIGV4aXN0ID0geyBbU0hBUkVEQ09ORklHX0FERFRPT0JKRUNUX0lOSVRJQUxfSU5ERVhdOiBleGlzdCB9XG4gICAgfVxuICAgIGV4aXN0W2tleV0gPSB2YWx1ZVxuICAgIHRoaXMuX19zZXQocGFyZW50S2V5LCBleGlzdCwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICAgIHJldHVybiBleGlzdFxuICB9XG5cbiAgcmVtb3ZlRnJvbU9iamVjdChwYXJlbnRLZXk6IHN0cmluZywga2V5VG9SZW1vdmU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlRnJvbU9iamVjdChwYXJlbnRLZXksIGtleVRvUmVtb3ZlLCBTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSlcbiAgfVxuXG4gIHJlbW92ZUZyb21PYmplY3RGbGFzaERhdGEocGFyZW50S2V5OiBzdHJpbmcsIGtleVRvUmVtb3ZlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5yZW1vdmVGcm9tT2JqZWN0TG9jYWxEYXRhKHBhcmVudEtleSwga2V5VG9SZW1vdmUpXG4gIH1cblxuICByZW1vdmVGcm9tT2JqZWN0TG9jYWxEYXRhKHBhcmVudEtleTogc3RyaW5nLCBrZXlUb1JlbW92ZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmVGcm9tT2JqZWN0KHBhcmVudEtleSwga2V5VG9SZW1vdmUsIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gIH1cblxuICByZW1vdmVGcm9tT2JqZWN0U2Vzc2lvbkRhdGEocGFyZW50S2V5OiBzdHJpbmcsIGtleVRvUmVtb3ZlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZUZyb21PYmplY3QocGFyZW50S2V5LCBrZXlUb1JlbW92ZSwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICB9XG5cbiAgZ2V0Rmxhc2hEYXRhKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmUoa2V5LCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICB9XG5cbiAgc2V0Rmxhc2hEYXRhKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIHRoaXMuc2V0TG9jYWxEYXRhKGtleSwgdmFsdWUpXG4gIH1cblxuICBnZXRMb2NhbERhdGEoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX2dldChrZXksIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gIH1cblxuICBzZXRMb2NhbERhdGEoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgdGhpcy5fX3NldChrZXksIHZhbHVlLCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICB9XG5cbiAgZ2V0U2Vzc2lvbkRhdGEoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX2dldChrZXksIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgfVxuXG4gIHNldFNlc3Npb25EYXRhKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIHRoaXMuX19zZXQoa2V5LCB2YWx1ZSwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICB9XG5cbiAgaGFzKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19oYXMoa2V5LCBTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSlcbiAgfVxuXG4gIGlzRmxhc2hEYXRhKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuaXNMb2NhbERhdGEoa2V5KVxuICB9XG5cbiAgaXNMb2NhbERhdGEoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX2hhcyhrZXksIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gIH1cblxuICBpc1Nlc3Npb25EYXRhKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19oYXMoa2V5LCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gIH1cblxuICByZW1vdmUoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZShrZXksIFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFKVxuICB9XG5cbiAgcmVtb3ZlU2Vzc2lvbkRhdGEoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZShrZXksIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgfVxuXG4gIHJlbW92ZUxvY2FsRGF0YShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlKGtleSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgfVxuXG4gIHJlbW92ZUZsYXNoRGF0YShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnJlbW92ZUxvY2FsRGF0YShrZXkpXG4gIH1cblxuICBkZXN0cm95KCkge1xuICAgIHRoaXMuX19kZXN0cm95KFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFKVxuICB9XG5cbiAgZGVzdHJveUxvY2FsRGF0YSgpIHtcbiAgICB0aGlzLl9fZGVzdHJveShTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICB9XG5cbiAgZGVzdHJveVNlc3Npb25EYXRhKCkge1xuICAgIHRoaXMuX19kZXN0cm95KFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgfVxuXG4gIGRlc3Ryb3lBbGwoKSB7XG4gICAgdGhpcy5fX2Rlc3Ryb3koU3RvcmFnZVR5cGUuREVTVFJPWV9BTEwpXG4gIH1cblxuICBpbmNyZW1lbnQoa2V5OiBzdHJpbmcsIHRocm93SWZOb3Rmb3VuZCA9IGZhbHNlKSB7XG4gICAgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuZHluYW1pY0NvbmZpZywga2V5KSkge1xuICAgICAgaWYgKHR5cGVvZiBOdW1iZXIucGFyc2VJbnQodGhpcy5keW5hbWljQ29uZmlnW2tleV0pID09PSAnbnVtYmVyJykge1xuICAgICAgICArK3RoaXMuZHluYW1pY0NvbmZpZ1trZXldXG4gICAgICAgIHJldHVybiB0aGlzLmR5bmFtaWNDb25maWdba2V5XVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3BlY2lmaWVkIGtleSBpcyBub3QgYSBudW1iZXIgY2FuJ3QgaW5jcmVtZW50XCIpXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aHJvd0lmTm90Zm91bmQpIHRocm93IG5ldyBFcnJvcignS2V5IG5vdCBmb3VuZCcpXG4gICAgfVxuICAgIHJldHVybiAodGhpcy5keW5hbWljQ29uZmlnW2tleV0gPSAxKVxuICB9XG5cbiAgZGVjcmVtZW50KGtleTogc3RyaW5nLCB0aHJvd0lmTm90Zm91bmQgPSBmYWxzZSkge1xuICAgIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmR5bmFtaWNDb25maWcsIGtleSkpIHtcbiAgICAgIGlmICh0eXBlb2YgTnVtYmVyLnBhcnNlSW50KHRoaXMuZHluYW1pY0NvbmZpZ1trZXldKSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgLS10aGlzLmR5bmFtaWNDb25maWdba2V5XVxuICAgICAgICByZXR1cm4gdGhpcy5keW5hbWljQ29uZmlnW2tleV1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwZWNpZmllZCBrZXkgaXMgbm90IGEgbnVtYmVyIGNhbid0IGRlY3JlbWVudFwiKVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhyb3dJZk5vdGZvdW5kKSB0aHJvdyBuZXcgRXJyb3IoJ0tleSBub3QgZm91bmQnKVxuICAgIH1cbiAgICByZXR1cm4gKHRoaXMuZHluYW1pY0NvbmZpZ1trZXldID0gLTEpXG4gIH1cblxuICBzdGF0aWMgcGFyc2UgPSAodmFsdWU6IHN0cmluZyB8IG51bGwpID0+IHtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhbHVlID0gYXRvYih2YWx1ZSlcbiAgICAgIH0gY2F0Y2ggKF9lcnIpIHtcbiAgICAgICAgLyogZW1wdHkgKi9cbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIHZhbHVlID0gSlNPTi5wYXJzZSh2YWx1ZSlcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8qIGVtcHR5ICovXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZVxuICB9XG5cbiAgc3RhdGljIHN0cmluZ2lmeSA9ICh2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSlcbiAgICAgIH1cbiAgICB9IGNhdGNoIChfZXJyKSB7XG4gICAgICAvKiBlbXB0eSAqL1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICB2YWx1ZSA9IGJ0b2EodmFsdWUgYXMgc3RyaW5nKVxuICAgIH0gY2F0Y2ggKF9lcnIpIHtcbiAgICAgIC8qIGVtcHR5ICovXG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlXG4gIH1cbn1cblxuY29uc3QgU2hhcmVkQ29uZmlnID0gbmV3IEdsb2JhbENvbmZpZygpXG5cbmV4cG9ydCBkZWZhdWx0IFNoYXJlZENvbmZpZ1xuIl19