/* eslint-disable require-jsdoc */
import { SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX } from './constants';
export var StorageType;
(function (StorageType) {
    StorageType[StorageType["MEMORY_STORAGE"] = 0] = "MEMORY_STORAGE";
    StorageType[StorageType["LOCAL_STORAGE"] = 1] = "LOCAL_STORAGE";
    StorageType[StorageType["SESSION_STORAGE"] = 2] = "SESSION_STORAGE";
    StorageType[StorageType["DESTROY_ALL"] = 3] = "DESTROY_ALL";
})(StorageType || (StorageType = {}));
class GlobalConfig {
    static _instance;
    dynamicConfig;
    __get;
    __set;
    __remove;
    __destroy;
    __removeFrom;
    __has;
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    __removeFromObject;
    constructor() {
        if (!GlobalConfig._instance) {
            GlobalConfig._instance = this;
            this.dynamicConfig = {};
            Object.freeze(GlobalConfig);
            Object.seal(GlobalConfig);
            this.__get = (key, where) => {
                try {
                    key = btoa(key);
                }
                catch (_err) {
                    /* empty */
                }
                let value;
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        value = localStorage.getItem(key);
                        value = GlobalConfig.parse(value);
                        break;
                    case StorageType.SESSION_STORAGE:
                        value = sessionStorage.getItem(key);
                        value = GlobalConfig.parse(value);
                        break;
                    default:
                        value = this.dynamicConfig[key];
                        break;
                }
                return value;
            };
            const switchSet = (key, value, where) => {
                try {
                    key = btoa(key);
                }
                catch (_err) {
                    /* empty */
                }
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        value = GlobalConfig.stringify(value);
                        localStorage.setItem(key, value);
                        break;
                    case StorageType.SESSION_STORAGE:
                        value = GlobalConfig.stringify(value);
                        sessionStorage.setItem(key, value);
                        break;
                    default:
                        this.dynamicConfig[key] = value;
                        break;
                }
            };
            this.__set = (key, value, where) => {
                if (key instanceof Object) {
                    let configKey;
                    let configObj;
                    if (key instanceof Array && value instanceof Array) {
                        configKey = key;
                        configObj = value;
                    }
                    else {
                        configKey = Object.keys(key);
                        configObj = Object.values(key);
                    }
                    for (let i = 0; i < configKey.length; i++) {
                        const k = configKey[i];
                        const v = configObj[i];
                        if (k) {
                            switchSet(k, v, where);
                        }
                    }
                }
                else {
                    if (key) {
                        switchSet(key, value, where);
                    }
                }
            };
            this.__remove = (key, where) => {
                let { key: copiedKey } = { key };
                try {
                    copiedKey = btoa(copiedKey);
                }
                catch (_err) {
                    /* empty */
                }
                let value;
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        value = this.__get(key, StorageType.LOCAL_STORAGE);
                        if (value)
                            localStorage.removeItem(copiedKey);
                        break;
                    case StorageType.SESSION_STORAGE:
                        value = this.__get(key, StorageType.SESSION_STORAGE);
                        if (value)
                            sessionStorage.removeItem(copiedKey);
                        break;
                    default:
                        value = this.__get(key, StorageType.MEMORY_STORAGE);
                        if (value)
                            delete this.dynamicConfig[copiedKey];
                        break;
                }
                return value;
            };
            this.__destroy = (where) => {
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        localStorage.clear();
                        break;
                    case StorageType.SESSION_STORAGE:
                        sessionStorage.clear();
                        break;
                    case StorageType.DESTROY_ALL:
                        this.dynamicConfig = {};
                        localStorage.clear();
                        sessionStorage.clear();
                        break;
                    default:
                        this.dynamicConfig = {};
                        break;
                }
            };
            this.__removeFrom = (fromKey, valueToRemove, where = StorageType.MEMORY_STORAGE) => {
                const exist = this.__get(fromKey, where);
                if (!exist)
                    return false;
                if (exist instanceof Array) {
                    let deleted;
                    if (!valueToRemove) {
                        deleted = exist.pop();
                    }
                    else {
                        const [deleted_temp] = [...exist[exist.indexOf(valueToRemove)]];
                        delete exist[exist.indexOf(valueToRemove)];
                        deleted = deleted_temp;
                    }
                    if (deleted) {
                        this.__set(fromKey, exist, where);
                    }
                    return deleted;
                }
                return false;
            };
            this.__removeFromObject = (fromKey, keyToRemove, where = StorageType.MEMORY_STORAGE) => {
                const exist = this.__get(fromKey, where);
                if (!exist)
                    return false;
                if (!(exist instanceof Array)) {
                    const tempName = `${keyToRemove}_temp`;
                    const { [tempName]: temp } = { [tempName]: exist[keyToRemove] };
                    delete exist[keyToRemove];
                    const deleted = temp;
                    if (deleted) {
                        this.__set(fromKey, exist, where);
                    }
                    return deleted;
                }
                return false;
            };
            this.__has = (key, where) => {
                const exist = this.__get(key, where);
                return !!exist;
            };
        }
        return GlobalConfig._instance;
    }
    get(key) {
        return this.__get(key, StorageType.MEMORY_STORAGE);
    }
    set(key, value) {
        this.__set(key, value, StorageType.MEMORY_STORAGE);
    }
    addTo(parentKey, valueToAdd) {
        if (!Object.hasOwnProperty.call(this.dynamicConfig, parentKey)) {
            this.dynamicConfig[parentKey] = [];
        }
        if (!(this.dynamicConfig[parentKey] instanceof Array)) {
            this.dynamicConfig[parentKey] = [this.dynamicConfig[parentKey]];
        }
        this.dynamicConfig[parentKey].push(valueToAdd);
        return this.dynamicConfig[parentKey];
    }
    addToFlashData(parentKey, valueToAdd) {
        return this.addToLocalData(parentKey, valueToAdd);
    }
    addToLocalData(parentKey, valueToAdd) {
        let exist = this.__get(parentKey, StorageType.LOCAL_STORAGE);
        if (!exist)
            exist = [];
        if (!(exist instanceof Array)) {
            exist = [exist];
        }
        exist.push(valueToAdd);
        this.__set(parentKey, exist, StorageType.LOCAL_STORAGE);
        return exist;
    }
    addToSessionData(parentKey, valueToAdd) {
        let exist = this.__get(parentKey, StorageType.SESSION_STORAGE);
        if (!exist)
            exist = [];
        if (!(exist instanceof Array)) {
            exist = [exist];
        }
        exist.push(valueToAdd);
        this.__set(parentKey, exist, StorageType.SESSION_STORAGE);
        return exist;
    }
    removeFrom(parentKey, valueToRemove) {
        return this.__removeFrom(parentKey, valueToRemove, StorageType.MEMORY_STORAGE);
    }
    removeFromFlashData(parentKey, valueToRemove) {
        return this.removeFromLocalData(parentKey, valueToRemove);
    }
    removeFromLocalData(parentKey, valueToRemove) {
        return this.__removeFrom(parentKey, valueToRemove, StorageType.LOCAL_STORAGE);
    }
    removeFromSessionData(parentKey, valueToRemove) {
        return this.__removeFrom(parentKey, valueToRemove, StorageType.SESSION_STORAGE);
    }
    addToObject(parentKey, key, value) {
        if (!Object.hasOwnProperty.call(this.dynamicConfig, parentKey)) {
            this.dynamicConfig[parentKey] = {};
        }
        if (typeof this.dynamicConfig[parentKey] == 'string' ||
            typeof this.dynamicConfig[parentKey] == 'number' ||
            typeof this.dynamicConfig[parentKey] == 'boolean') {
            this.dynamicConfig[parentKey] = { [SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX]: this.dynamicConfig[parentKey] };
        }
        this.dynamicConfig[parentKey][key] = value;
        return this.dynamicConfig[parentKey];
    }
    addToObjectFlashData(parentKey, key, value) {
        return this.addToObjectLocalData(parentKey, key, value);
    }
    addToObjectLocalData(parentKey, key, value) {
        let exist = this.__get(parentKey, StorageType.LOCAL_STORAGE);
        if (!exist)
            exist = {};
        if (typeof exist == 'string' || typeof exist == 'number' || typeof exist == 'boolean') {
            exist = { [SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX]: exist };
        }
        exist[key] = value;
        this.__set(parentKey, exist, StorageType.LOCAL_STORAGE);
        return exist;
    }
    addToObjectSessionData(parentKey, key, value) {
        let exist = this.__get(parentKey, StorageType.SESSION_STORAGE);
        if (!exist)
            exist = {};
        if (typeof exist == 'string' || typeof exist == 'number' || typeof exist == 'boolean') {
            exist = { [SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX]: exist };
        }
        exist[key] = value;
        this.__set(parentKey, exist, StorageType.SESSION_STORAGE);
        return exist;
    }
    removeFromObject(parentKey, keyToRemove) {
        return this.__removeFromObject(parentKey, keyToRemove, StorageType.MEMORY_STORAGE);
    }
    removeFromObjectFlashData(parentKey, keyToRemove) {
        return this.removeFromObjectLocalData(parentKey, keyToRemove);
    }
    removeFromObjectLocalData(parentKey, keyToRemove) {
        return this.__removeFromObject(parentKey, keyToRemove, StorageType.LOCAL_STORAGE);
    }
    removeFromObjectSessionData(parentKey, keyToRemove) {
        return this.__removeFromObject(parentKey, keyToRemove, StorageType.SESSION_STORAGE);
    }
    getFlashData(key) {
        return this.__remove(key, StorageType.LOCAL_STORAGE);
    }
    setFlashData(key, value) {
        this.setLocalData(key, value);
    }
    getLocalData(key) {
        return this.__get(key, StorageType.LOCAL_STORAGE);
    }
    setLocalData(key, value) {
        this.__set(key, value, StorageType.LOCAL_STORAGE);
    }
    getSessionData(key) {
        return this.__get(key, StorageType.SESSION_STORAGE);
    }
    setSessionData(key, value) {
        this.__set(key, value, StorageType.SESSION_STORAGE);
    }
    has(key) {
        return this.__has(key, StorageType.MEMORY_STORAGE);
    }
    isFlashData(key) {
        return this.isLocalData(key);
    }
    isLocalData(key) {
        return this.__has(key, StorageType.LOCAL_STORAGE);
    }
    isSessionData(key) {
        return this.__has(key, StorageType.SESSION_STORAGE);
    }
    remove(key) {
        return this.__remove(key, StorageType.MEMORY_STORAGE);
    }
    removeSessionData(key) {
        return this.__remove(key, StorageType.SESSION_STORAGE);
    }
    removeLocalData(key) {
        return this.__remove(key, StorageType.LOCAL_STORAGE);
    }
    removeFlashData(key) {
        return this.removeLocalData(key);
    }
    destroy() {
        this.__destroy(StorageType.MEMORY_STORAGE);
    }
    destroyLocalData() {
        this.__destroy(StorageType.LOCAL_STORAGE);
    }
    destroySessionData() {
        this.__destroy(StorageType.SESSION_STORAGE);
    }
    destroyAll() {
        this.__destroy(StorageType.DESTROY_ALL);
    }
    increment(key, throwIfNotfound = false) {
        if (Object.hasOwnProperty.call(this.dynamicConfig, key)) {
            if (typeof Number.parseInt(this.dynamicConfig[key]) === 'number') {
                ++this.dynamicConfig[key];
                return this.dynamicConfig[key];
            }
            else {
                throw new Error("Specified key is not a number can't increment");
            }
        }
        else {
            if (throwIfNotfound)
                throw new Error('Key not found');
        }
        return (this.dynamicConfig[key] = 1);
    }
    decrement(key, throwIfNotfound = false) {
        if (Object.hasOwnProperty.call(this.dynamicConfig, key)) {
            if (typeof Number.parseInt(this.dynamicConfig[key]) === 'number') {
                --this.dynamicConfig[key];
                return this.dynamicConfig[key];
            }
            else {
                throw new Error("Specified key is not a number can't decrement");
            }
        }
        else {
            if (throwIfNotfound)
                throw new Error('Key not found');
        }
        return (this.dynamicConfig[key] = -1);
    }
    static parse = (value) => {
        if (value) {
            try {
                value = atob(value);
            }
            catch (_err) {
                /* empty */
            }
            try {
                value = JSON.parse(value);
            }
            catch (error) {
                /* empty */
            }
        }
        return value;
    };
    static stringify = (value) => {
        try {
            if (value instanceof Object) {
                value = JSON.stringify(value);
            }
        }
        catch (_err) {
            /* empty */
        }
        try {
            value = btoa(value);
        }
        catch (_err) {
            /* empty */
        }
        return value;
    };
}
const SharedConfig = new GlobalConfig();
export default SharedConfig;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2hhcmVkQ29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbW1vbi9TaGFyZWRDb25maWcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsa0NBQWtDO0FBRWxDLE9BQU8sRUFBRSxzQ0FBc0MsRUFBRSxNQUFNLGFBQWEsQ0FBQTtBQUdwRSxNQUFNLENBQU4sSUFBa0IsV0FLakI7QUFMRCxXQUFrQixXQUFXO0lBQzNCLGlFQUFjLENBQUE7SUFDZCwrREFBYSxDQUFBO0lBQ2IsbUVBQWUsQ0FBQTtJQUNmLDJEQUFXLENBQUE7QUFDYixDQUFDLEVBTGlCLFdBQVcsS0FBWCxXQUFXLFFBSzVCO0FBRUQsTUFBTSxZQUFZO0lBQ04sTUFBTSxDQUFDLFNBQVMsQ0FBYztJQUVoQyxhQUFhLENBQWE7SUFDMUIsS0FBSyxDQUFrRTtJQUN2RSxLQUFLLENBQXFGO0lBQzFGLFFBQVEsQ0FBa0U7SUFDMUUsU0FBUyxDQUErQjtJQUN4QyxZQUFZLENBSVc7SUFDdkIsS0FBSyxDQUErQztJQUM1RCw4REFBOEQ7SUFDdEQsa0JBQWtCLENBQXFFO0lBRS9GO1FBQ0UsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLEVBQUU7WUFDM0IsWUFBWSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUE7WUFDN0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUE7WUFDdkIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQTtZQUMzQixNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFBO1lBRXpCLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBa0IsRUFBRSxFQUFFO2dCQUN2QyxJQUFJO29CQUNGLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7aUJBQ2hCO2dCQUFDLE9BQU8sSUFBSSxFQUFFO29CQUNiLFdBQVc7aUJBQ1o7Z0JBRUQsSUFBSSxLQUFvQixDQUFBO2dCQUV4QixRQUFRLEtB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T0FBTyxJQUFJLEVBQUU7WUFDYixXQUFXO1NBQ1o7UUFFRCxPQUFPLEtBQUssQ0FBQTtJQUNkLENBQUMsQ0FBQTs7QUFHSCxNQUFNLFlBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFBO0FBRXZDLGVBQWUsWUFBWSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgcmVxdWlyZS1qc2RvYyAqL1xuXG5pbXBvcnQgeyBTSEFSRURDT05GSUdfQUREVE9PQkpFQ1RfSU5JVElBTF9JTkRFWCB9IGZyb20gJy4vY29uc3RhbnRzJ1xuaW1wb3J0IElBbnlPYmplY3QgZnJvbSAnLi9tb2RlbHMvSUFueU9iamVjdCdcblxuZXhwb3J0IGNvbnN0IGVudW0gU3RvcmFnZVR5cGUge1xuICBNRU1PUllfU1RPUkFHRSxcbiAgTE9DQUxfU1RPUkFHRSxcbiAgU0VTU0lPTl9TVE9SQUdFLFxuICBERVNUUk9ZX0FMTCxcbn1cblxuY2xhc3MgR2xvYmFsQ29uZmlnIHtcbiAgcHJvdGVjdGVkIHN0YXRpYyBfaW5zdGFuY2U6IEdsb2JhbENvbmZpZ1xuXG4gIHByaXZhdGUgZHluYW1pY0NvbmZpZyE6IElBbnlPYmplY3RcbiAgcHJpdmF0ZSBfX2dldCE6IChrZXk6IHN0cmluZywgd2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiBJQW55T2JqZWN0IHwgc3RyaW5nIHwgbnVsbFxuICBwcml2YXRlIF9fc2V0ITogKGtleTogc3RyaW5nIHwgSUFueU9iamVjdCwgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QsIHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4gdm9pZFxuICBwcml2YXRlIF9fcmVtb3ZlITogKGtleTogc3RyaW5nLCB3aGVyZTogU3RvcmFnZVR5cGUpID0+IElBbnlPYmplY3QgfCBzdHJpbmcgfCBudWxsXG4gIHByaXZhdGUgX19kZXN0cm95ITogKHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4gdm9pZFxuICBwcml2YXRlIF9fcmVtb3ZlRnJvbSE6IChcbiAgICBmcm9tS2V5OiBzdHJpbmcsXG4gICAgdmFsdWVUb1JlbW92ZT86IElBbnlPYmplY3QgfCBzdHJpbmcsXG4gICAgd2hlcmU/OiBTdG9yYWdlVHlwZSxcbiAgKSA9PiBJQW55T2JqZWN0IHwgc3RyaW5nIHwgbnVsbFxuICBwcml2YXRlIF9faGFzITogKGtleTogc3RyaW5nLCB3aGVyZTogU3RvcmFnZVR5cGUpID0+IGJvb2xlYW5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcHJpdmF0ZSBfX3JlbW92ZUZyb21PYmplY3QhOiAoZnJvbUtleTogc3RyaW5nLCBrZXlUb1JlbW92ZTogc3RyaW5nLCB3aGVyZT86IFN0b3JhZ2VUeXBlKSA9PiBhbnlcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBpZiAoIUdsb2JhbENvbmZpZy5faW5zdGFuY2UpIHtcbiAgICAgIEdsb2JhbENvbmZpZy5faW5zdGFuY2UgPSB0aGlzXG4gICAgICB0aGlzLmR5bmFtaWNDb25maWcgPSB7fVxuICAgICAgT2JqZWN0LmZyZWV6ZShHbG9iYWxDb25maWcpXG4gICAgICBPYmplY3Quc2VhbChHbG9iYWxDb25maWcpXG5cbiAgICAgIHRoaXMuX19nZXQgPSAoa2V5LCB3aGVyZTogU3RvcmFnZVR5cGUpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBrZXkgPSBidG9hKGtleSlcbiAgICAgICAgfSBjYXRjaCAoX2Vycikge1xuICAgICAgICAgIC8qIGVtcHR5ICovXG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdmFsdWU6IHN0cmluZyB8IG51bGxcblxuICAgICAgICBzd2l0Y2ggKHdoZXJlKSB7XG4gICAgICAgICAgY2FzZSBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFOlxuICAgICAgICAgICAgdmFsdWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpXG4gICAgICAgICAgICB2YWx1ZSA9IEdsb2JhbENvbmZpZy5wYXJzZSh2YWx1ZSlcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBjYXNlIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRTpcbiAgICAgICAgICAgIHZhbHVlID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShrZXkpXG4gICAgICAgICAgICB2YWx1ZSA9IEdsb2JhbENvbmZpZy5wYXJzZSh2YWx1ZSlcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmR5bmFtaWNDb25maWdba2V5XVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZVxuICAgICAgfVxuXG4gICAgICBjb25zdCBzd2l0Y2hTZXQgPSAoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0LCB3aGVyZTogU3RvcmFnZVR5cGUpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBrZXkgPSBidG9hKGtleSlcbiAgICAgICAgfSBjYXRjaCAoX2Vycikge1xuICAgICAgICAgIC8qIGVtcHR5ICovXG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKHdoZXJlKSB7XG4gICAgICAgICAgY2FzZSBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFOlxuICAgICAgICAgICAgdmFsdWUgPSBHbG9iYWxDb25maWcuc3RyaW5naWZ5KHZhbHVlKVxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSBhcyBzdHJpbmcpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgY2FzZSBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0U6XG4gICAgICAgICAgICB2YWx1ZSA9IEdsb2JhbENvbmZpZy5zdHJpbmdpZnkodmFsdWUpXG4gICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUgYXMgc3RyaW5nKVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aGlzLmR5bmFtaWNDb25maWdba2V5XSA9IHZhbHVlXG4gICAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX19zZXQgPSAoa2V5OiBzdHJpbmcgfCBJQW55T2JqZWN0LCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCwgd2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiB7XG4gICAgICAgIGlmIChrZXkgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICBsZXQgY29uZmlnS2V5XG4gICAgICAgICAgbGV0IGNvbmZpZ09ialxuICAgICAgICAgIGlmIChrZXkgaW5zdGFuY2VvZiBBcnJheSAmJiB2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICBjb25maWdLZXkgPSBrZXlcbiAgICAgICAgICAgIGNvbmZpZ09iaiA9IHZhbHVlXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbmZpZ0tleSA9IE9iamVjdC5rZXlzKGtleSlcbiAgICAgICAgICAgIGNvbmZpZ09iaiA9IE9iamVjdC52YWx1ZXMoa2V5KVxuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbmZpZ0tleS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgayA9IGNvbmZpZ0tleVtpXVxuICAgICAgICAgICAgY29uc3QgdiA9IGNvbmZpZ09ialtpXVxuICAgICAgICAgICAgaWYgKGspIHtcbiAgICAgICAgICAgICAgc3dpdGNoU2V0KGssIHYsIHdoZXJlKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICBzd2l0Y2hTZXQoa2V5LCB2YWx1ZSwgd2hlcmUpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX19yZW1vdmUgPSAoa2V5OiBzdHJpbmcsIHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4ge1xuICAgICAgICBsZXQgeyBrZXk6IGNvcGllZEtleSB9ID0geyBrZXkgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29waWVkS2V5ID0gYnRvYShjb3BpZWRLZXkpXG4gICAgICAgIH0gY2F0Y2ggKF9lcnIpIHtcbiAgICAgICAgICAvKiBlbXB0eSAqL1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHZhbHVlXG5cbiAgICAgICAgc3dpdGNoICh3aGVyZSkge1xuICAgICAgICAgIGNhc2UgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRTpcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5fX2dldChrZXksIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gICAgICAgICAgICBpZiAodmFsdWUpIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGNvcGllZEtleSlcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBjYXNlIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRTpcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5fX2dldChrZXksIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgICAgICAgICAgIGlmICh2YWx1ZSkgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShjb3BpZWRLZXkpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5fX2dldChrZXksIFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFKVxuICAgICAgICAgICAgaWYgKHZhbHVlKSBkZWxldGUgdGhpcy5keW5hbWljQ29uZmlnW2NvcGllZEtleV1cbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdmFsdWVcbiAgICAgIH1cblxuICAgICAgdGhpcy5fX2Rlc3Ryb3kgPSAod2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiB7XG4gICAgICAgIHN3aXRjaCAod2hlcmUpIHtcbiAgICAgICAgICBjYXNlIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0U6XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UuY2xlYXIoKVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgIGNhc2UgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFOlxuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UuY2xlYXIoKVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgIGNhc2UgU3RvcmFnZVR5cGUuREVTVFJPWV9BTEw6XG4gICAgICAgICAgICB0aGlzLmR5bmFtaWNDb25maWcgPSB7fVxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmNsZWFyKClcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLmNsZWFyKClcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhpcy5keW5hbWljQ29uZmlnID0ge31cbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5fX3JlbW92ZUZyb20gPSAoXG4gICAgICAgIGZyb21LZXksXG4gICAgICAgIHZhbHVlVG9SZW1vdmU/OiBJQW55T2JqZWN0IHwgc3RyaW5nLFxuICAgICAgICB3aGVyZTogU3RvcmFnZVR5cGUgPSBTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSxcbiAgICAgICkgPT4ge1xuICAgICAgICBjb25zdCBleGlzdCA9IHRoaXMuX19nZXQoZnJvbUtleSwgd2hlcmUpXG4gICAgICAgIGlmICghZXhpc3QpIHJldHVybiBmYWxzZVxuICAgICAgICBpZiAoZXhpc3QgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgIGxldCBkZWxldGVkXG4gICAgICAgICAgaWYgKCF2YWx1ZVRvUmVtb3ZlKSB7XG4gICAgICAgICAgICBkZWxldGVkID0gZXhpc3QucG9wKClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgW2RlbGV0ZWRfdGVtcF0gPSBbLi4uZXhpc3RbZXhpc3QuaW5kZXhPZih2YWx1ZVRvUmVtb3ZlKV1dXG4gICAgICAgICAgICBkZWxldGUgZXhpc3RbZXhpc3QuaW5kZXhPZih2YWx1ZVRvUmVtb3ZlKV1cbiAgICAgICAgICAgIGRlbGV0ZWQgPSBkZWxldGVkX3RlbXBcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGRlbGV0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX19zZXQoZnJvbUtleSwgZXhpc3QsIHdoZXJlKVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZGVsZXRlZFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gICAgICB0aGlzLl9fcmVtb3ZlRnJvbU9iamVjdCA9IChcbiAgICAgICAgZnJvbUtleTogc3RyaW5nLFxuICAgICAgICBrZXlUb1JlbW92ZTogc3RyaW5nLFxuICAgICAgICB3aGVyZTogU3RvcmFnZVR5cGUgPSBTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSxcbiAgICAgICkgPT4ge1xuICAgICAgICBjb25zdCBleGlzdDogSUFueU9iamVjdCA9IHRoaXMuX19nZXQoZnJvbUtleSwgd2hlcmUpIGFzIElBbnlPYmplY3RcbiAgICAgICAgaWYgKCFleGlzdCkgcmV0dXJuIGZhbHNlXG4gICAgICAgIGlmICghKGV4aXN0IGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICAgICAgY29uc3QgdGVtcE5hbWUgPSBgJHtrZXlUb1JlbW92ZX1fdGVtcGBcbiAgICAgICAgICBjb25zdCB7IFt0ZW1wTmFtZV06IHRlbXAgfSA9IHsgW3RlbXBOYW1lXTogZXhpc3Rba2V5VG9SZW1vdmVdIH1cbiAgICAgICAgICBkZWxldGUgZXhpc3Rba2V5VG9SZW1vdmVdXG4gICAgICAgICAgY29uc3QgZGVsZXRlZCA9IHRlbXBcblxuICAgICAgICAgIGlmIChkZWxldGVkKSB7XG4gICAgICAgICAgICB0aGlzLl9fc2V0KGZyb21LZXksIGV4aXN0LCB3aGVyZSlcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGRlbGV0ZWRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cblxuICAgICAgdGhpcy5fX2hhcyA9IChrZXksIHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4ge1xuICAgICAgICBjb25zdCBleGlzdCA9IHRoaXMuX19nZXQoa2V5LCB3aGVyZSlcbiAgICAgICAgcmV0dXJuICEhZXhpc3RcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIEdsb2JhbENvbmZpZy5faW5zdGFuY2VcbiAgfVxuXG4gIGdldChrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0KGtleSwgU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UpXG4gIH1cblxuICBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgdGhpcy5fX3NldChrZXksIHZhbHVlLCBTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSlcbiAgfVxuXG4gIGFkZFRvKHBhcmVudEtleTogc3RyaW5nLCB2YWx1ZVRvQWRkOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgaWYgKCFPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmR5bmFtaWNDb25maWcsIHBhcmVudEtleSkpIHtcbiAgICAgIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldID0gW11cbiAgICB9XG4gICAgaWYgKCEodGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0gaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldID0gW3RoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldXVxuICAgIH1cbiAgICB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XS5wdXNoKHZhbHVlVG9BZGQpXG4gICAgcmV0dXJuIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldXG4gIH1cblxuICBhZGRUb0ZsYXNoRGF0YShwYXJlbnRLZXk6IHN0cmluZywgdmFsdWVUb0FkZDogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIHJldHVybiB0aGlzLmFkZFRvTG9jYWxEYXRhKHBhcmVudEtleSwgdmFsdWVUb0FkZClcbiAgfVxuXG4gIGFkZFRvTG9jYWxEYXRhKHBhcmVudEtleTogc3RyaW5nLCB2YWx1ZVRvQWRkOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgbGV0IGV4aXN0ID0gdGhpcy5fX2dldChwYXJlbnRLZXksIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gICAgaWYgKCFleGlzdCkgZXhpc3QgPSBbXVxuICAgIGlmICghKGV4aXN0IGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICBleGlzdCA9IFtleGlzdF1cbiAgICB9XG4gICAgZXhpc3QucHVzaCh2YWx1ZVRvQWRkKVxuICAgIHRoaXMuX19zZXQocGFyZW50S2V5LCBleGlzdCwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgICByZXR1cm4gZXhpc3RcbiAgfVxuXG4gIGFkZFRvU2Vzc2lvbkRhdGEocGFyZW50S2V5OiBzdHJpbmcsIHZhbHVlVG9BZGQ6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICBsZXQgZXhpc3QgPSB0aGlzLl9fZ2V0KHBhcmVudEtleSwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICAgIGlmICghZXhpc3QpIGV4aXN0ID0gW11cbiAgICBpZiAoIShleGlzdCBpbnN0YW5jZW9mIEFycmF5KSkge1xuICAgICAgZXhpc3QgPSBbZXhpc3RdXG4gICAgfVxuICAgIGV4aXN0LnB1c2godmFsdWVUb0FkZClcbiAgICB0aGlzLl9fc2V0KHBhcmVudEtleSwgZXhpc3QsIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgICByZXR1cm4gZXhpc3RcbiAgfVxuXG4gIHJlbW92ZUZyb20ocGFyZW50S2V5OiBzdHJpbmcsIHZhbHVlVG9SZW1vdmU/OiBJQW55T2JqZWN0IHwgc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmVGcm9tKHBhcmVudEtleSwgdmFsdWVUb1JlbW92ZSwgU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UpXG4gIH1cblxuICByZW1vdmVGcm9tRmxhc2hEYXRhKHBhcmVudEtleTogc3RyaW5nLCB2YWx1ZVRvUmVtb3ZlPzogSUFueU9iamVjdCB8IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnJlbW92ZUZyb21Mb2NhbERhdGEocGFyZW50S2V5LCB2YWx1ZVRvUmVtb3ZlKVxuICB9XG5cbiAgcmVtb3ZlRnJvbUxvY2FsRGF0YShwYXJlbnRLZXk6IHN0cmluZywgdmFsdWVUb1JlbW92ZT86IElBbnlPYmplY3QgfCBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZUZyb20ocGFyZW50S2V5LCB2YWx1ZVRvUmVtb3ZlLCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICB9XG5cbiAgcmVtb3ZlRnJvbVNlc3Npb25EYXRhKHBhcmVudEtleTogc3RyaW5nLCB2YWx1ZVRvUmVtb3ZlPzogSUFueU9iamVjdCB8IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlRnJvbShwYXJlbnRLZXksIHZhbHVlVG9SZW1vdmUsIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgfVxuXG4gIGFkZFRvT2JqZWN0KHBhcmVudEtleTogc3RyaW5nLCBrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICBpZiAoIU9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuZHluYW1pY0NvbmZpZywgcGFyZW50S2V5KSkge1xuICAgICAgdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0gPSB7fVxuICAgIH1cbiAgICBpZiAoXG4gICAgICB0eXBlb2YgdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0gPT0gJ3N0cmluZycgfHxcbiAgICAgIHR5cGVvZiB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XSA9PSAnbnVtYmVyJyB8fFxuICAgICAgdHlwZW9mIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldID09ICdib29sZWFuJ1xuICAgICkge1xuICAgICAgdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0gPSB7IFtTSEFSRURDT05GSUdfQUREVE9PQkpFQ1RfSU5JVElBTF9JTkRFWF06IHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldIH1cbiAgICB9XG4gICAgdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV1ba2V5XSA9IHZhbHVlXG4gICAgcmV0dXJuIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldXG4gIH1cblxuICBhZGRUb09iamVjdEZsYXNoRGF0YShwYXJlbnRLZXk6IHN0cmluZywga2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgcmV0dXJuIHRoaXMuYWRkVG9PYmplY3RMb2NhbERhdGEocGFyZW50S2V5LCBrZXksIHZhbHVlKVxuICB9XG5cbiAgYWRkVG9PYmplY3RMb2NhbERhdGEocGFyZW50S2V5OiBzdHJpbmcsIGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIGxldCBleGlzdDogSUFueU9iamVjdCA9IHRoaXMuX19nZXQocGFyZW50S2V5LCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKSBhcyBJQW55T2JqZWN0XG4gICAgaWYgKCFleGlzdCkgZXhpc3QgPSB7fVxuICAgIGlmICh0eXBlb2YgZXhpc3QgPT0gJ3N0cmluZycgfHwgdHlwZW9mIGV4aXN0ID09ICdudW1iZXInIHx8IHR5cGVvZiBleGlzdCA9PSAnYm9vbGVhbicpIHtcbiAgICAgIGV4aXN0ID0geyBbU0hBUkVEQ09ORklHX0FERFRPT0JKRUNUX0lOSVRJQUxfSU5ERVhdOiBleGlzdCB9XG4gICAgfVxuICAgIGV4aXN0W2tleV0gPSB2YWx1ZVxuICAgIHRoaXMuX19zZXQocGFyZW50S2V5LCBleGlzdCwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgICByZXR1cm4gZXhpc3RcbiAgfVxuXG4gIGFkZFRvT2JqZWN0U2Vzc2lvbkRhdGEocGFyZW50S2V5OiBzdHJpbmcsIGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIGxldCBleGlzdDogSUFueU9iamVjdCA9IHRoaXMuX19nZXQocGFyZW50S2V5LCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpIGFzIElBbnlPYmplY3RcbiAgICBpZiAoIWV4aXN0KSBleGlzdCA9IHt9XG4gICAgaWYgKHR5cGVvZiBleGlzdCA9PSAnc3RyaW5nJyB8fCB0eXBlb2YgZXhpc3QgPT0gJ251bWJlcicgfHwgdHlwZW9mIGV4aXN0ID09ICdib29sZWFuJykge1xuICAgICAgZXhpc3QgPSB7IFtTSEFSRURDT05GSUdfQUREVE9PQkpFQ1RfSU5JVElBTF9JTkRFWF06IGV4aXN0IH1cbiAgICB9XG4gICAgZXhpc3Rba2V5XSA9IHZhbHVlXG4gICAgdGhpcy5fX3NldChwYXJlbnRLZXksIGV4aXN0LCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gICAgcmV0dXJuIGV4aXN0XG4gIH1cblxuICByZW1vdmVGcm9tT2JqZWN0KHBhcmVudEtleTogc3RyaW5nLCBrZXlUb1JlbW92ZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmVGcm9tT2JqZWN0KHBhcmVudEtleSwga2V5VG9SZW1vdmUsIFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFKVxuICB9XG5cbiAgcmVtb3ZlRnJvbU9iamVjdEZsYXNoRGF0YShwYXJlbnRLZXk6IHN0cmluZywga2V5VG9SZW1vdmU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnJlbW92ZUZyb21PYmplY3RMb2NhbERhdGEocGFyZW50S2V5LCBrZXlUb1JlbW92ZSlcbiAgfVxuXG4gIHJlbW92ZUZyb21PYmplY3RMb2NhbERhdGEocGFyZW50S2V5OiBzdHJpbmcsIGtleVRvUmVtb3ZlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZUZyb21PYmplY3QocGFyZW50S2V5LCBrZXlUb1JlbW92ZSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgfVxuXG4gIHJlbW92ZUZyb21PYmplY3RTZXNzaW9uRGF0YShwYXJlbnRLZXk6IHN0cmluZywga2V5VG9SZW1vdmU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlRnJvbU9iamVjdChwYXJlbnRLZXksIGtleVRvUmVtb3ZlLCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gIH1cblxuICBnZXRGbGFzaERhdGEoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZShrZXksIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gIH1cblxuICBzZXRGbGFzaERhdGEoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgdGhpcy5zZXRMb2NhbERhdGEoa2V5LCB2YWx1ZSlcbiAgfVxuXG4gIGdldExvY2FsRGF0YShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0KGtleSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgfVxuXG4gIHNldExvY2FsRGF0YShrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICB0aGlzLl9fc2V0KGtleSwgdmFsdWUsIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gIH1cblxuICBnZXRTZXNzaW9uRGF0YShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0KGtleSwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICB9XG5cbiAgc2V0U2Vzc2lvbkRhdGEoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgdGhpcy5fX3NldChrZXksIHZhbHVlLCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gIH1cblxuICBoYXMoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX2hhcyhrZXksIFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFKVxuICB9XG5cbiAgaXNGbGFzaERhdGEoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5pc0xvY2FsRGF0YShrZXkpXG4gIH1cblxuICBpc0xvY2FsRGF0YShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9faGFzKGtleSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgfVxuXG4gIGlzU2Vzc2lvbkRhdGEoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX2hhcyhrZXksIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgfVxuXG4gIHJlbW92ZShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlKGtleSwgU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UpXG4gIH1cblxuICByZW1vdmVTZXNzaW9uRGF0YShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlKGtleSwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICB9XG5cbiAgcmVtb3ZlTG9jYWxEYXRhKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmUoa2V5LCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICB9XG5cbiAgcmVtb3ZlRmxhc2hEYXRhKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucmVtb3ZlTG9jYWxEYXRhKGtleSlcbiAgfVxuXG4gIGRlc3Ryb3koKSB7XG4gICAgdGhpcy5fX2Rlc3Ryb3koU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UpXG4gIH1cblxuICBkZXN0cm95TG9jYWxEYXRhKCkge1xuICAgIHRoaXMuX19kZXN0cm95KFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gIH1cblxuICBkZXN0cm95U2Vzc2lvbkRhdGEoKSB7XG4gICAgdGhpcy5fX2Rlc3Ryb3koU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICB9XG5cbiAgZGVzdHJveUFsbCgpIHtcbiAgICB0aGlzLl9fZGVzdHJveShTdG9yYWdlVHlwZS5ERVNUUk9ZX0FMTClcbiAgfVxuXG4gIGluY3JlbWVudChrZXk6IHN0cmluZywgdGhyb3dJZk5vdGZvdW5kID0gZmFsc2UpIHtcbiAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodGhpcy5keW5hbWljQ29uZmlnLCBrZXkpKSB7XG4gICAgICBpZiAodHlwZW9mIE51bWJlci5wYXJzZUludCh0aGlzLmR5bmFtaWNDb25maWdba2V5XSkgPT09ICdudW1iZXInKSB7XG4gICAgICAgICsrdGhpcy5keW5hbWljQ29uZmlnW2tleV1cbiAgICAgICAgcmV0dXJuIHRoaXMuZHluYW1pY0NvbmZpZ1trZXldXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcGVjaWZpZWQga2V5IGlzIG5vdCBhIG51bWJlciBjYW4ndCBpbmNyZW1lbnRcIilcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRocm93SWZOb3Rmb3VuZCkgdGhyb3cgbmV3IEVycm9yKCdLZXkgbm90IGZvdW5kJylcbiAgICB9XG4gICAgcmV0dXJuICh0aGlzLmR5bmFtaWNDb25maWdba2V5XSA9IDEpXG4gIH1cblxuICBkZWNyZW1lbnQoa2V5OiBzdHJpbmcsIHRocm93SWZOb3Rmb3VuZCA9IGZhbHNlKSB7XG4gICAgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuZHluYW1pY0NvbmZpZywga2V5KSkge1xuICAgICAgaWYgKHR5cGVvZiBOdW1iZXIucGFyc2VJbnQodGhpcy5keW5hbWljQ29uZmlnW2tleV0pID09PSAnbnVtYmVyJykge1xuICAgICAgICAtLXRoaXMuZHluYW1pY0NvbmZpZ1trZXldXG4gICAgICAgIHJldHVybiB0aGlzLmR5bmFtaWNDb25maWdba2V5XVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3BlY2lmaWVkIGtleSBpcyBub3QgYSBudW1iZXIgY2FuJ3QgZGVjcmVtZW50XCIpXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aHJvd0lmTm90Zm91bmQpIHRocm93IG5ldyBFcnJvcignS2V5IG5vdCBmb3VuZCcpXG4gICAgfVxuICAgIHJldHVybiAodGhpcy5keW5hbWljQ29uZmlnW2tleV0gPSAtMSlcbiAgfVxuXG4gIHN0YXRpYyBwYXJzZSA9ICh2YWx1ZTogc3RyaW5nIHwgbnVsbCkgPT4ge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFsdWUgPSBhdG9iKHZhbHVlKVxuICAgICAgfSBjYXRjaCAoX2Vycikge1xuICAgICAgICAvKiBlbXB0eSAqL1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgdmFsdWUgPSBKU09OLnBhcnNlKHZhbHVlKVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLyogZW1wdHkgKi9cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlXG4gIH1cblxuICBzdGF0aWMgc3RyaW5naWZ5ID0gKHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKF9lcnIpIHtcbiAgICAgIC8qIGVtcHR5ICovXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHZhbHVlID0gYnRvYSh2YWx1ZSBhcyBzdHJpbmcpXG4gICAgfSBjYXRjaCAoX2Vycikge1xuICAgICAgLyogZW1wdHkgKi9cbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWVcbiAgfVxufVxuXG5jb25zdCBTaGFyZWRDb25maWcgPSBuZXcgR2xvYmFsQ29uZmlnKClcblxuZXhwb3J0IGRlZmF1bHQgU2hhcmVkQ29uZmlnXG4iXX0=