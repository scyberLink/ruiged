"use strict";
/* eslint-disable require-jsdoc */
Object.defineProperty(exports, "__esModule", { value: true });
exports.StorageType = void 0;
const constants_1 = require("./constants");
var StorageType;
(function (StorageType) {
    StorageType[StorageType["MEMORY_STORAGE"] = 0] = "MEMORY_STORAGE";
    StorageType[StorageType["LOCAL_STORAGE"] = 1] = "LOCAL_STORAGE";
    StorageType[StorageType["SESSION_STORAGE"] = 2] = "SESSION_STORAGE";
    StorageType[StorageType["DESTROY_ALL"] = 3] = "DESTROY_ALL";
})(StorageType = exports.StorageType || (exports.StorageType = {}));
class GlobalConfig {
    constructor() {
        if (!GlobalConfig._instance) {
            GlobalConfig._instance = this;
            this.dynamicConfig = {};
            Object.freeze(GlobalConfig);
            Object.seal(GlobalConfig);
            this.__get = (key, where) => {
                try {
                    key = btoa(key);
                }
                catch (_err) {
                    /* empty */
                }
                let value;
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        value = localStorage.getItem(key);
                        value = GlobalConfig.parse(value);
                        break;
                    case StorageType.SESSION_STORAGE:
                        value = sessionStorage.getItem(key);
                        value = GlobalConfig.parse(value);
                        break;
                    default:
                        value = this.dynamicConfig[key];
                        break;
                }
                return value;
            };
            const switchSet = (key, value, where) => {
                try {
                    key = btoa(key);
                }
                catch (_err) {
                    /* empty */
                }
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        value = GlobalConfig.stringify(value);
                        localStorage.setItem(key, value);
                        break;
                    case StorageType.SESSION_STORAGE:
                        value = GlobalConfig.stringify(value);
                        sessionStorage.setItem(key, value);
                        break;
                    default:
                        this.dynamicConfig[key] = value;
                        break;
                }
            };
            this.__set = (key, value, where) => {
                if (key instanceof Object) {
                    let configKey;
                    let configObj;
                    if (key instanceof Array && value instanceof Array) {
                        configKey = key;
                        configObj = value;
                    }
                    else {
                        configKey = Object.keys(key);
                        configObj = Object.values(key);
                    }
                    for (let i = 0; i < configKey.length; i++) {
                        const k = configKey[i];
                        const v = configObj[i];
                        if (k) {
                            switchSet(k, v, where);
                        }
                    }
                }
                else {
                    if (key) {
                        switchSet(key, value, where);
                    }
                }
            };
            this.__remove = (key, where) => {
                let { key: copiedKey } = { key };
                try {
                    copiedKey = btoa(copiedKey);
                }
                catch (_err) {
                    /* empty */
                }
                let value;
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        value = this.__get(key, StorageType.LOCAL_STORAGE);
                        if (value)
                            localStorage.removeItem(copiedKey);
                        break;
                    case StorageType.SESSION_STORAGE:
                        value = this.__get(key, StorageType.SESSION_STORAGE);
                        if (value)
                            sessionStorage.removeItem(copiedKey);
                        break;
                    default:
                        value = this.__get(key, StorageType.MEMORY_STORAGE);
                        if (value)
                            delete this.dynamicConfig[copiedKey];
                        break;
                }
                return value;
            };
            this.__destroy = (where) => {
                switch (where) {
                    case StorageType.LOCAL_STORAGE:
                        localStorage.clear();
                        break;
                    case StorageType.SESSION_STORAGE:
                        sessionStorage.clear();
                        break;
                    case StorageType.DESTROY_ALL:
                        this.dynamicConfig = {};
                        localStorage.clear();
                        sessionStorage.clear();
                        break;
                    default:
                        this.dynamicConfig = {};
                        break;
                }
            };
            this.__removeFrom = (fromKey, valueToRemove, where = StorageType.MEMORY_STORAGE) => {
                const exist = this.__get(fromKey, where);
                if (!exist)
                    return false;
                if (exist instanceof Array) {
                    let deleted;
                    if (!valueToRemove) {
                        deleted = exist.pop();
                    }
                    else {
                        const [deleted_temp] = [...exist[exist.indexOf(valueToRemove)]];
                        delete exist[exist.indexOf(valueToRemove)];
                        deleted = deleted_temp;
                    }
                    if (deleted) {
                        this.__set(fromKey, exist, where);
                    }
                    return deleted;
                }
                return false;
            };
            this.__removeFromObject = (fromKey, keyToRemove, where = StorageType.MEMORY_STORAGE) => {
                const exist = this.__get(fromKey, where);
                if (!exist)
                    return false;
                if (!(exist instanceof Array)) {
                    const tempName = `${keyToRemove}_temp`;
                    const { [tempName]: temp } = { [tempName]: exist[keyToRemove] };
                    delete exist[keyToRemove];
                    const deleted = temp;
                    if (deleted) {
                        this.__set(fromKey, exist, where);
                    }
                    return deleted;
                }
                return false;
            };
            this.__has = (key, where) => {
                const exist = this.__get(key, where);
                return !!exist;
            };
        }
        return GlobalConfig._instance;
    }
    get(key) {
        return this.__get(key, StorageType.MEMORY_STORAGE);
    }
    set(key, value) {
        this.__set(key, value, StorageType.MEMORY_STORAGE);
    }
    addTo(parentKey, valueToAdd) {
        if (!Object.hasOwnProperty.call(this.dynamicConfig, parentKey)) {
            this.dynamicConfig[parentKey] = [];
        }
        if (!(this.dynamicConfig[parentKey] instanceof Array)) {
            this.dynamicConfig[parentKey] = [this.dynamicConfig[parentKey]];
        }
        this.dynamicConfig[parentKey].push(valueToAdd);
        return this.dynamicConfig[parentKey];
    }
    addToFlashData(parentKey, valueToAdd) {
        return this.addToLocalData(parentKey, valueToAdd);
    }
    addToLocalData(parentKey, valueToAdd) {
        let exist = this.__get(parentKey, StorageType.LOCAL_STORAGE);
        if (!exist)
            exist = [];
        if (!(exist instanceof Array)) {
            exist = [exist];
        }
        exist.push(valueToAdd);
        this.__set(parentKey, exist, StorageType.LOCAL_STORAGE);
        return exist;
    }
    addToSessionData(parentKey, valueToAdd) {
        let exist = this.__get(parentKey, StorageType.SESSION_STORAGE);
        if (!exist)
            exist = [];
        if (!(exist instanceof Array)) {
            exist = [exist];
        }
        exist.push(valueToAdd);
        this.__set(parentKey, exist, StorageType.SESSION_STORAGE);
        return exist;
    }
    removeFrom(parentKey, valueToRemove) {
        return this.__removeFrom(parentKey, valueToRemove, StorageType.MEMORY_STORAGE);
    }
    removeFromFlashData(parentKey, valueToRemove) {
        return this.removeFromLocalData(parentKey, valueToRemove);
    }
    removeFromLocalData(parentKey, valueToRemove) {
        return this.__removeFrom(parentKey, valueToRemove, StorageType.LOCAL_STORAGE);
    }
    removeFromSessionData(parentKey, valueToRemove) {
        return this.__removeFrom(parentKey, valueToRemove, StorageType.SESSION_STORAGE);
    }
    addToObject(parentKey, key, value) {
        if (!Object.hasOwnProperty.call(this.dynamicConfig, parentKey)) {
            this.dynamicConfig[parentKey] = {};
        }
        if (typeof this.dynamicConfig[parentKey] == 'string' ||
            typeof this.dynamicConfig[parentKey] == 'number' ||
            typeof this.dynamicConfig[parentKey] == 'boolean') {
            this.dynamicConfig[parentKey] = { [constants_1.SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX]: this.dynamicConfig[parentKey] };
        }
        this.dynamicConfig[parentKey][key] = value;
        return this.dynamicConfig[parentKey];
    }
    addToObjectFlashData(parentKey, key, value) {
        return this.addToObjectLocalData(parentKey, key, value);
    }
    addToObjectLocalData(parentKey, key, value) {
        let exist = this.__get(parentKey, StorageType.LOCAL_STORAGE);
        if (!exist)
            exist = {};
        if (typeof exist == 'string' || typeof exist == 'number' || typeof exist == 'boolean') {
            exist = { [constants_1.SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX]: exist };
        }
        exist[key] = value;
        this.__set(parentKey, exist, StorageType.LOCAL_STORAGE);
        return exist;
    }
    addToObjectSessionData(parentKey, key, value) {
        let exist = this.__get(parentKey, StorageType.SESSION_STORAGE);
        if (!exist)
            exist = {};
        if (typeof exist == 'string' || typeof exist == 'number' || typeof exist == 'boolean') {
            exist = { [constants_1.SHAREDCONFIG_ADDTOOBJECT_INITIAL_INDEX]: exist };
        }
        exist[key] = value;
        this.__set(parentKey, exist, StorageType.SESSION_STORAGE);
        return exist;
    }
    removeFromObject(parentKey, keyToRemove) {
        return this.__removeFromObject(parentKey, keyToRemove, StorageType.MEMORY_STORAGE);
    }
    removeFromObjectFlashData(parentKey, keyToRemove) {
        return this.removeFromObjectLocalData(parentKey, keyToRemove);
    }
    removeFromObjectLocalData(parentKey, keyToRemove) {
        return this.__removeFromObject(parentKey, keyToRemove, StorageType.LOCAL_STORAGE);
    }
    removeFromObjectSessionData(parentKey, keyToRemove) {
        return this.__removeFromObject(parentKey, keyToRemove, StorageType.SESSION_STORAGE);
    }
    getFlashData(key) {
        return this.__remove(key, StorageType.LOCAL_STORAGE);
    }
    setFlashData(key, value) {
        this.setLocalData(key, value);
    }
    getLocalData(key) {
        return this.__get(key, StorageType.LOCAL_STORAGE);
    }
    setLocalData(key, value) {
        this.__set(key, value, StorageType.LOCAL_STORAGE);
    }
    getSessionData(key) {
        return this.__get(key, StorageType.SESSION_STORAGE);
    }
    setSessionData(key, value) {
        this.__set(key, value, StorageType.SESSION_STORAGE);
    }
    has(key) {
        return this.__has(key, StorageType.MEMORY_STORAGE);
    }
    isFlashData(key) {
        return this.isLocalData(key);
    }
    isLocalData(key) {
        return this.__has(key, StorageType.LOCAL_STORAGE);
    }
    isSessionData(key) {
        return this.__has(key, StorageType.SESSION_STORAGE);
    }
    remove(key) {
        return this.__remove(key, StorageType.MEMORY_STORAGE);
    }
    removeSessionData(key) {
        return this.__remove(key, StorageType.SESSION_STORAGE);
    }
    removeLocalData(key) {
        return this.__remove(key, StorageType.LOCAL_STORAGE);
    }
    removeFlashData(key) {
        return this.removeLocalData(key);
    }
    destroy() {
        this.__destroy(StorageType.MEMORY_STORAGE);
    }
    destroyLocalData() {
        this.__destroy(StorageType.LOCAL_STORAGE);
    }
    destroySessionData() {
        this.__destroy(StorageType.SESSION_STORAGE);
    }
    destroyAll() {
        this.__destroy(StorageType.DESTROY_ALL);
    }
    increment(key, throwIfNotfound = false) {
        if (Object.hasOwnProperty.call(this.dynamicConfig, key)) {
            if (typeof Number.parseInt(this.dynamicConfig[key]) === 'number') {
                ++this.dynamicConfig[key];
                return this.dynamicConfig[key];
            }
            else {
                throw new Error("Specified key is not a number can't increment");
            }
        }
        else {
            if (throwIfNotfound)
                throw new Error('Key not found');
        }
        return (this.dynamicConfig[key] = 1);
    }
    decrement(key, throwIfNotfound = false) {
        if (Object.hasOwnProperty.call(this.dynamicConfig, key)) {
            if (typeof Number.parseInt(this.dynamicConfig[key]) === 'number') {
                --this.dynamicConfig[key];
                return this.dynamicConfig[key];
            }
            else {
                throw new Error("Specified key is not a number can't decrement");
            }
        }
        else {
            if (throwIfNotfound)
                throw new Error('Key not found');
        }
        return (this.dynamicConfig[key] = -1);
    }
}
GlobalConfig.parse = (value) => {
    if (value) {
        try {
            value = atob(value);
        }
        catch (_err) {
            /* empty */
        }
        try {
            value = JSON.parse(value);
        }
        catch (error) {
            /* empty */
        }
    }
    return value;
};
GlobalConfig.stringify = (value) => {
    try {
        if (value instanceof Object) {
            value = JSON.stringify(value);
        }
    }
    catch (_err) {
        /* empty */
    }
    try {
        value = btoa(value);
    }
    catch (_err) {
        /* empty */
    }
    return value;
};
const SharedConfig = new GlobalConfig();
exports.default = SharedConfig;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2hhcmVkQ29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbW1vbi9TaGFyZWRDb25maWcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLGtDQUFrQzs7O0FBRWxDLDJDQUFvRTtBQUdwRSxJQUFrQixXQUtqQjtBQUxELFdBQWtCLFdBQVc7SUFDM0IsaUVBQWMsQ0FBQTtJQUNkLCtEQUFhLENBQUE7SUFDYixtRUFBZSxDQUFBO0lBQ2YsMkRBQVcsQ0FBQTtBQUNiLENBQUMsRUFMaUIsV0FBVyxHQUFYLG1CQUFXLEtBQVgsbUJBQVcsUUFLNUI7QUFFRCxNQUFNLFlBQVk7SUFpQmhCO1FBQ0UsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLEVBQUU7WUFDM0IsWUFBWSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUE7WUFDN0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUE7WUFDdkIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQTtZQUMzQixNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFBO1lBRXpCLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBa0IsRUFBRSxFQUFFO2dCQUN2QyxJQUFJO29CQUNGLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7aUJBQ2hCO2dCQUFDLE9BQU8sSUFBSSxFQUFFO29CQUNiLFdBQVc7aUJBQ1o7Z0JBRUQsSUFBSSxLQUFvQixDQUFBO2dCQUV4QixRQUFRLEtBQUssRUFBRTtvQkFDYixLQUFLLFdBQVcsQ0FBQyxhQUFhO3dCQUM1QixLQUFLLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQTt3QkFDakMsS0FBSyxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUE7d0JBQ2pDLE1BQUs7b0JBRVAsS0FBSyxXQUFXLENBQUMsZUFBZTt3QkFDOUIsS0FBSyxHQUFHLGNBQWMs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U0FDRjthQUFNO1lBQ0wsSUFBSSxlQUFlO2dCQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUE7U0FDdEQ7UUFDRCxPQUFPLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ3ZDLENBQUM7O0FBRU0sa0JBQUssR0FBRyxDQUFDLEtBQW9CLEVBQUUsRUFBRTtJQUN0QyxJQUFJLEtBQUssRUFBRTtRQUNULElBQUk7WUFDRixLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1NBQ3BCO1FBQUMsT0FBTyxJQUFJLEVBQUU7WUFDYixXQUFXO1NBQ1o7UUFDRCxJQUFJO1lBQ0YsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDMUI7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLFdBQVc7U0FDWjtLQUNGO0lBQ0QsT0FBTyxLQUFLLENBQUE7QUFDZCxDQUFDLENBQUE7QUFFTSxzQkFBUyxHQUFHLENBQUMsS0FBMEIsRUFBRSxFQUFFO0lBQ2hELElBQUk7UUFDRixJQUFJLEtBQUssWUFBWSxNQUFNLEVBQUU7WUFDM0IsS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDOUI7S0FDRjtJQUFDLE9BQU8sSUFBSSxFQUFFO1FBQ2IsV0FBVztLQUNaO0lBRUQsSUFBSTtRQUNGLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBZSxDQUFDLENBQUE7S0FDOUI7SUFBQyxPQUFPLElBQUksRUFBRTtRQUNiLFdBQVc7S0FDWjtJQUVELE9BQU8sS0FBSyxDQUFBO0FBQ2QsQ0FBQyxDQUFBO0FBR0gsTUFBTSxZQUFZLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQTtBQUV2QyxrQkFBZSxZQUFZLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSByZXF1aXJlLWpzZG9jICovXG5cbmltcG9ydCB7IFNIQVJFRENPTkZJR19BRERUT09CSkVDVF9JTklUSUFMX0lOREVYIH0gZnJvbSAnLi9jb25zdGFudHMnXG5pbXBvcnQgSUFueU9iamVjdCBmcm9tICcuL21vZGVscy9JQW55T2JqZWN0J1xuXG5leHBvcnQgY29uc3QgZW51bSBTdG9yYWdlVHlwZSB7XG4gIE1FTU9SWV9TVE9SQUdFLFxuICBMT0NBTF9TVE9SQUdFLFxuICBTRVNTSU9OX1NUT1JBR0UsXG4gIERFU1RST1lfQUxMLFxufVxuXG5jbGFzcyBHbG9iYWxDb25maWcge1xuICBwcm90ZWN0ZWQgc3RhdGljIF9pbnN0YW5jZTogR2xvYmFsQ29uZmlnXG5cbiAgcHJpdmF0ZSBkeW5hbWljQ29uZmlnITogSUFueU9iamVjdFxuICBwcml2YXRlIF9fZ2V0ITogKGtleTogc3RyaW5nLCB3aGVyZTogU3RvcmFnZVR5cGUpID0+IElBbnlPYmplY3QgfCBzdHJpbmcgfCBudWxsXG4gIHByaXZhdGUgX19zZXQhOiAoa2V5OiBzdHJpbmcgfCBJQW55T2JqZWN0LCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCwgd2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiB2b2lkXG4gIHByaXZhdGUgX19yZW1vdmUhOiAoa2V5OiBzdHJpbmcsIHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4gSUFueU9iamVjdCB8IHN0cmluZyB8IG51bGxcbiAgcHJpdmF0ZSBfX2Rlc3Ryb3khOiAod2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiB2b2lkXG4gIHByaXZhdGUgX19yZW1vdmVGcm9tITogKFxuICAgIGZyb21LZXk6IHN0cmluZyxcbiAgICB2YWx1ZVRvUmVtb3ZlPzogSUFueU9iamVjdCB8IHN0cmluZyxcbiAgICB3aGVyZT86IFN0b3JhZ2VUeXBlLFxuICApID0+IElBbnlPYmplY3QgfCBzdHJpbmcgfCBudWxsXG4gIHByaXZhdGUgX19oYXMhOiAoa2V5OiBzdHJpbmcsIHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4gYm9vbGVhblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBwcml2YXRlIF9fcmVtb3ZlRnJvbU9iamVjdCE6IChmcm9tS2V5OiBzdHJpbmcsIGtleVRvUmVtb3ZlOiBzdHJpbmcsIHdoZXJlPzogU3RvcmFnZVR5cGUpID0+IGFueVxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGlmICghR2xvYmFsQ29uZmlnLl9pbnN0YW5jZSkge1xuICAgICAgR2xvYmFsQ29uZmlnLl9pbnN0YW5jZSA9IHRoaXNcbiAgICAgIHRoaXMuZHluYW1pY0NvbmZpZyA9IHt9XG4gICAgICBPYmplY3QuZnJlZXplKEdsb2JhbENvbmZpZylcbiAgICAgIE9iamVjdC5zZWFsKEdsb2JhbENvbmZpZylcblxuICAgICAgdGhpcy5fX2dldCA9IChrZXksIHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGtleSA9IGJ0b2Eoa2V5KVxuICAgICAgICB9IGNhdGNoIChfZXJyKSB7XG4gICAgICAgICAgLyogZW1wdHkgKi9cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB2YWx1ZTogc3RyaW5nIHwgbnVsbFxuXG4gICAgICAgIHN3aXRjaCAod2hlcmUpIHtcbiAgICAgICAgICBjYXNlIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0U6XG4gICAgICAgICAgICB2YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSlcbiAgICAgICAgICAgIHZhbHVlID0gR2xvYmFsQ29uZmlnLnBhcnNlKHZhbHVlKVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgIGNhc2UgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFOlxuICAgICAgICAgICAgdmFsdWUgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGtleSlcbiAgICAgICAgICAgIHZhbHVlID0gR2xvYmFsQ29uZmlnLnBhcnNlKHZhbHVlKVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB2YWx1ZSA9IHRoaXMuZHluYW1pY0NvbmZpZ1trZXldXG4gICAgICAgICAgICBicmVha1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZhbHVlXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN3aXRjaFNldCA9IChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QsIHdoZXJlOiBTdG9yYWdlVHlwZSkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGtleSA9IGJ0b2Eoa2V5KVxuICAgICAgICB9IGNhdGNoIChfZXJyKSB7XG4gICAgICAgICAgLyogZW1wdHkgKi9cbiAgICAgICAgfVxuXG4gICAgICAgIHN3aXRjaCAod2hlcmUpIHtcbiAgICAgICAgICBjYXNlIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0U6XG4gICAgICAgICAgICB2YWx1ZSA9IEdsb2JhbENvbmZpZy5zdHJpbmdpZnkodmFsdWUpXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlIGFzIHN0cmluZylcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBjYXNlIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRTpcbiAgICAgICAgICAgIHZhbHVlID0gR2xvYmFsQ29uZmlnLnN0cmluZ2lmeSh2YWx1ZSlcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSBhcyBzdHJpbmcpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY0NvbmZpZ1trZXldID0gdmFsdWVcbiAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5fX3NldCA9IChrZXk6IHN0cmluZyB8IElBbnlPYmplY3QsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0LCB3aGVyZTogU3RvcmFnZVR5cGUpID0+IHtcbiAgICAgICAgaWYgKGtleSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICAgIGxldCBjb25maWdLZXlcbiAgICAgICAgICBsZXQgY29uZmlnT2JqXG4gICAgICAgICAgaWYgKGtleSBpbnN0YW5jZW9mIEFycmF5ICYmIHZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgIGNvbmZpZ0tleSA9IGtleVxuICAgICAgICAgICAgY29uZmlnT2JqID0gdmFsdWVcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uZmlnS2V5ID0gT2JqZWN0LmtleXMoa2V5KVxuICAgICAgICAgICAgY29uZmlnT2JqID0gT2JqZWN0LnZhbHVlcyhrZXkpXG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29uZmlnS2V5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBrID0gY29uZmlnS2V5W2ldXG4gICAgICAgICAgICBjb25zdCB2ID0gY29uZmlnT2JqW2ldXG4gICAgICAgICAgICBpZiAoaykge1xuICAgICAgICAgICAgICBzd2l0Y2hTZXQoaywgdiwgd2hlcmUpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChrZXkpIHtcbiAgICAgICAgICAgIHN3aXRjaFNldChrZXksIHZhbHVlLCB3aGVyZSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5fX3JlbW92ZSA9IChrZXk6IHN0cmluZywgd2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiB7XG4gICAgICAgIGxldCB7IGtleTogY29waWVkS2V5IH0gPSB7IGtleSB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb3BpZWRLZXkgPSBidG9hKGNvcGllZEtleSlcbiAgICAgICAgfSBjYXRjaCAoX2Vycikge1xuICAgICAgICAgIC8qIGVtcHR5ICovXG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdmFsdWVcblxuICAgICAgICBzd2l0Y2ggKHdoZXJlKSB7XG4gICAgICAgICAgY2FzZSBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFOlxuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9fZ2V0KGtleSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgICAgICAgICAgIGlmICh2YWx1ZSkgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oY29waWVkS2V5KVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgIGNhc2UgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFOlxuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9fZ2V0KGtleSwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICAgICAgICAgICAgaWYgKHZhbHVlKSBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKGNvcGllZEtleSlcbiAgICAgICAgICAgIGJyZWFrXG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLl9fZ2V0KGtleSwgU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UpXG4gICAgICAgICAgICBpZiAodmFsdWUpIGRlbGV0ZSB0aGlzLmR5bmFtaWNDb25maWdbY29waWVkS2V5XVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB2YWx1ZVxuICAgICAgfVxuXG4gICAgICB0aGlzLl9fZGVzdHJveSA9ICh3aGVyZTogU3RvcmFnZVR5cGUpID0+IHtcbiAgICAgICAgc3dpdGNoICh3aGVyZSkge1xuICAgICAgICAgIGNhc2UgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRTpcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5jbGVhcigpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgY2FzZSBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0U6XG4gICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5jbGVhcigpXG4gICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgY2FzZSBTdG9yYWdlVHlwZS5ERVNUUk9ZX0FMTDpcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY0NvbmZpZyA9IHt9XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UuY2xlYXIoKVxuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UuY2xlYXIoKVxuICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aGlzLmR5bmFtaWNDb25maWcgPSB7fVxuICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLl9fcmVtb3ZlRnJvbSA9IChcbiAgICAgICAgZnJvbUtleSxcbiAgICAgICAgdmFsdWVUb1JlbW92ZT86IElBbnlPYmplY3QgfCBzdHJpbmcsXG4gICAgICAgIHdoZXJlOiBTdG9yYWdlVHlwZSA9IFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFLFxuICAgICAgKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0ID0gdGhpcy5fX2dldChmcm9tS2V5LCB3aGVyZSlcbiAgICAgICAgaWYgKCFleGlzdCkgcmV0dXJuIGZhbHNlXG4gICAgICAgIGlmIChleGlzdCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgbGV0IGRlbGV0ZWRcbiAgICAgICAgICBpZiAoIXZhbHVlVG9SZW1vdmUpIHtcbiAgICAgICAgICAgIGRlbGV0ZWQgPSBleGlzdC5wb3AoKVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBbZGVsZXRlZF90ZW1wXSA9IFsuLi5leGlzdFtleGlzdC5pbmRleE9mKHZhbHVlVG9SZW1vdmUpXV1cbiAgICAgICAgICAgIGRlbGV0ZSBleGlzdFtleGlzdC5pbmRleE9mKHZhbHVlVG9SZW1vdmUpXVxuICAgICAgICAgICAgZGVsZXRlZCA9IGRlbGV0ZWRfdGVtcFxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZGVsZXRlZCkge1xuICAgICAgICAgICAgdGhpcy5fX3NldChmcm9tS2V5LCBleGlzdCwgd2hlcmUpXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBkZWxldGVkXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIHRoaXMuX19yZW1vdmVGcm9tT2JqZWN0ID0gKFxuICAgICAgICBmcm9tS2V5OiBzdHJpbmcsXG4gICAgICAgIGtleVRvUmVtb3ZlOiBzdHJpbmcsXG4gICAgICAgIHdoZXJlOiBTdG9yYWdlVHlwZSA9IFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFLFxuICAgICAgKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0OiBJQW55T2JqZWN0ID0gdGhpcy5fX2dldChmcm9tS2V5LCB3aGVyZSkgYXMgSUFueU9iamVjdFxuICAgICAgICBpZiAoIWV4aXN0KSByZXR1cm4gZmFsc2VcbiAgICAgICAgaWYgKCEoZXhpc3QgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgICAgICBjb25zdCB0ZW1wTmFtZSA9IGAke2tleVRvUmVtb3ZlfV90ZW1wYFxuICAgICAgICAgIGNvbnN0IHsgW3RlbXBOYW1lXTogdGVtcCB9ID0geyBbdGVtcE5hbWVdOiBleGlzdFtrZXlUb1JlbW92ZV0gfVxuICAgICAgICAgIGRlbGV0ZSBleGlzdFtrZXlUb1JlbW92ZV1cbiAgICAgICAgICBjb25zdCBkZWxldGVkID0gdGVtcFxuXG4gICAgICAgICAgaWYgKGRlbGV0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX19zZXQoZnJvbUtleSwgZXhpc3QsIHdoZXJlKVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZGVsZXRlZFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gICAgICB0aGlzLl9faGFzID0gKGtleSwgd2hlcmU6IFN0b3JhZ2VUeXBlKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0ID0gdGhpcy5fX2dldChrZXksIHdoZXJlKVxuICAgICAgICByZXR1cm4gISFleGlzdFxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gR2xvYmFsQ29uZmlnLl9pbnN0YW5jZVxuICB9XG5cbiAgZ2V0KGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19nZXQoa2V5LCBTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSlcbiAgfVxuXG4gIHNldChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICB0aGlzLl9fc2V0KGtleSwgdmFsdWUsIFN0b3JhZ2VUeXBlLk1FTU9SWV9TVE9SQUdFKVxuICB9XG5cbiAgYWRkVG8ocGFyZW50S2V5OiBzdHJpbmcsIHZhbHVlVG9BZGQ6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICBpZiAoIU9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRoaXMuZHluYW1pY0NvbmZpZywgcGFyZW50S2V5KSkge1xuICAgICAgdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0gPSBbXVxuICAgIH1cbiAgICBpZiAoISh0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XSBpbnN0YW5jZW9mIEFycmF5KSkge1xuICAgICAgdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0gPSBbdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV1dXG4gICAgfVxuICAgIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldLnB1c2godmFsdWVUb0FkZClcbiAgICByZXR1cm4gdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV1cbiAgfVxuXG4gIGFkZFRvRmxhc2hEYXRhKHBhcmVudEtleTogc3RyaW5nLCB2YWx1ZVRvQWRkOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgcmV0dXJuIHRoaXMuYWRkVG9Mb2NhbERhdGEocGFyZW50S2V5LCB2YWx1ZVRvQWRkKVxuICB9XG5cbiAgYWRkVG9Mb2NhbERhdGEocGFyZW50S2V5OiBzdHJpbmcsIHZhbHVlVG9BZGQ6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICBsZXQgZXhpc3QgPSB0aGlzLl9fZ2V0KHBhcmVudEtleSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgICBpZiAoIWV4aXN0KSBleGlzdCA9IFtdXG4gICAgaWYgKCEoZXhpc3QgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgIGV4aXN0ID0gW2V4aXN0XVxuICAgIH1cbiAgICBleGlzdC5wdXNoKHZhbHVlVG9BZGQpXG4gICAgdGhpcy5fX3NldChwYXJlbnRLZXksIGV4aXN0LCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICAgIHJldHVybiBleGlzdFxuICB9XG5cbiAgYWRkVG9TZXNzaW9uRGF0YShwYXJlbnRLZXk6IHN0cmluZywgdmFsdWVUb0FkZDogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIGxldCBleGlzdCA9IHRoaXMuX19nZXQocGFyZW50S2V5LCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gICAgaWYgKCFleGlzdCkgZXhpc3QgPSBbXVxuICAgIGlmICghKGV4aXN0IGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICBleGlzdCA9IFtleGlzdF1cbiAgICB9XG4gICAgZXhpc3QucHVzaCh2YWx1ZVRvQWRkKVxuICAgIHRoaXMuX19zZXQocGFyZW50S2V5LCBleGlzdCwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICAgIHJldHVybiBleGlzdFxuICB9XG5cbiAgcmVtb3ZlRnJvbShwYXJlbnRLZXk6IHN0cmluZywgdmFsdWVUb1JlbW92ZT86IElBbnlPYmplY3QgfCBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZUZyb20ocGFyZW50S2V5LCB2YWx1ZVRvUmVtb3ZlLCBTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSlcbiAgfVxuXG4gIHJlbW92ZUZyb21GbGFzaERhdGEocGFyZW50S2V5OiBzdHJpbmcsIHZhbHVlVG9SZW1vdmU/OiBJQW55T2JqZWN0IHwgc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucmVtb3ZlRnJvbUxvY2FsRGF0YShwYXJlbnRLZXksIHZhbHVlVG9SZW1vdmUpXG4gIH1cblxuICByZW1vdmVGcm9tTG9jYWxEYXRhKHBhcmVudEtleTogc3RyaW5nLCB2YWx1ZVRvUmVtb3ZlPzogSUFueU9iamVjdCB8IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlRnJvbShwYXJlbnRLZXksIHZhbHVlVG9SZW1vdmUsIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gIH1cblxuICByZW1vdmVGcm9tU2Vzc2lvbkRhdGEocGFyZW50S2V5OiBzdHJpbmcsIHZhbHVlVG9SZW1vdmU/OiBJQW55T2JqZWN0IHwgc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmVGcm9tKHBhcmVudEtleSwgdmFsdWVUb1JlbW92ZSwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICB9XG5cbiAgYWRkVG9PYmplY3QocGFyZW50S2V5OiBzdHJpbmcsIGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIGlmICghT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodGhpcy5keW5hbWljQ29uZmlnLCBwYXJlbnRLZXkpKSB7XG4gICAgICB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XSA9IHt9XG4gICAgfVxuICAgIGlmIChcbiAgICAgIHR5cGVvZiB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XSA9PSAnc3RyaW5nJyB8fFxuICAgICAgdHlwZW9mIHRoaXMuZHluYW1pY0NvbmZpZ1twYXJlbnRLZXldID09ICdudW1iZXInIHx8XG4gICAgICB0eXBlb2YgdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0gPT0gJ2Jvb2xlYW4nXG4gICAgKSB7XG4gICAgICB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XSA9IHsgW1NIQVJFRENPTkZJR19BRERUT09CSkVDVF9JTklUSUFMX0lOREVYXTogdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV0gfVxuICAgIH1cbiAgICB0aGlzLmR5bmFtaWNDb25maWdbcGFyZW50S2V5XVtrZXldID0gdmFsdWVcbiAgICByZXR1cm4gdGhpcy5keW5hbWljQ29uZmlnW3BhcmVudEtleV1cbiAgfVxuXG4gIGFkZFRvT2JqZWN0Rmxhc2hEYXRhKHBhcmVudEtleTogc3RyaW5nLCBrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICByZXR1cm4gdGhpcy5hZGRUb09iamVjdExvY2FsRGF0YShwYXJlbnRLZXksIGtleSwgdmFsdWUpXG4gIH1cblxuICBhZGRUb09iamVjdExvY2FsRGF0YShwYXJlbnRLZXk6IHN0cmluZywga2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgbGV0IGV4aXN0OiBJQW55T2JqZWN0ID0gdGhpcy5fX2dldChwYXJlbnRLZXksIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpIGFzIElBbnlPYmplY3RcbiAgICBpZiAoIWV4aXN0KSBleGlzdCA9IHt9XG4gICAgaWYgKHR5cGVvZiBleGlzdCA9PSAnc3RyaW5nJyB8fCB0eXBlb2YgZXhpc3QgPT0gJ251bWJlcicgfHwgdHlwZW9mIGV4aXN0ID09ICdib29sZWFuJykge1xuICAgICAgZXhpc3QgPSB7IFtTSEFSRURDT05GSUdfQUREVE9PQkpFQ1RfSU5JVElBTF9JTkRFWF06IGV4aXN0IH1cbiAgICB9XG4gICAgZXhpc3Rba2V5XSA9IHZhbHVlXG4gICAgdGhpcy5fX3NldChwYXJlbnRLZXksIGV4aXN0LCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICAgIHJldHVybiBleGlzdFxuICB9XG5cbiAgYWRkVG9PYmplY3RTZXNzaW9uRGF0YShwYXJlbnRLZXk6IHN0cmluZywga2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcgfCBJQW55T2JqZWN0KSB7XG4gICAgbGV0IGV4aXN0OiBJQW55T2JqZWN0ID0gdGhpcy5fX2dldChwYXJlbnRLZXksIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSkgYXMgSUFueU9iamVjdFxuICAgIGlmICghZXhpc3QpIGV4aXN0ID0ge31cbiAgICBpZiAodHlwZW9mIGV4aXN0ID09ICdzdHJpbmcnIHx8IHR5cGVvZiBleGlzdCA9PSAnbnVtYmVyJyB8fCB0eXBlb2YgZXhpc3QgPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICBleGlzdCA9IHsgW1NIQVJFRENPTkZJR19BRERUT09CSkVDVF9JTklUSUFMX0lOREVYXTogZXhpc3QgfVxuICAgIH1cbiAgICBleGlzdFtrZXldID0gdmFsdWVcbiAgICB0aGlzLl9fc2V0KHBhcmVudEtleSwgZXhpc3QsIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgICByZXR1cm4gZXhpc3RcbiAgfVxuXG4gIHJlbW92ZUZyb21PYmplY3QocGFyZW50S2V5OiBzdHJpbmcsIGtleVRvUmVtb3ZlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZUZyb21PYmplY3QocGFyZW50S2V5LCBrZXlUb1JlbW92ZSwgU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UpXG4gIH1cblxuICByZW1vdmVGcm9tT2JqZWN0Rmxhc2hEYXRhKHBhcmVudEtleTogc3RyaW5nLCBrZXlUb1JlbW92ZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMucmVtb3ZlRnJvbU9iamVjdExvY2FsRGF0YShwYXJlbnRLZXksIGtleVRvUmVtb3ZlKVxuICB9XG5cbiAgcmVtb3ZlRnJvbU9iamVjdExvY2FsRGF0YShwYXJlbnRLZXk6IHN0cmluZywga2V5VG9SZW1vdmU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlRnJvbU9iamVjdChwYXJlbnRLZXksIGtleVRvUmVtb3ZlLCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICB9XG5cbiAgcmVtb3ZlRnJvbU9iamVjdFNlc3Npb25EYXRhKHBhcmVudEtleTogc3RyaW5nLCBrZXlUb1JlbW92ZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmVGcm9tT2JqZWN0KHBhcmVudEtleSwga2V5VG9SZW1vdmUsIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgfVxuXG4gIGdldEZsYXNoRGF0YShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9fcmVtb3ZlKGtleSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgfVxuXG4gIHNldEZsYXNoRGF0YShrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICB0aGlzLnNldExvY2FsRGF0YShrZXksIHZhbHVlKVxuICB9XG5cbiAgZ2V0TG9jYWxEYXRhKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19nZXQoa2V5LCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICB9XG5cbiAgc2V0TG9jYWxEYXRhKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgSUFueU9iamVjdCkge1xuICAgIHRoaXMuX19zZXQoa2V5LCB2YWx1ZSwgU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgfVxuXG4gIGdldFNlc3Npb25EYXRhKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19nZXQoa2V5LCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gIH1cblxuICBzZXRTZXNzaW9uRGF0YShrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QpIHtcbiAgICB0aGlzLl9fc2V0KGtleSwgdmFsdWUsIFN0b3JhZ2VUeXBlLlNFU1NJT05fU1RPUkFHRSlcbiAgfVxuXG4gIGhhcyhrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9faGFzKGtleSwgU3RvcmFnZVR5cGUuTUVNT1JZX1NUT1JBR0UpXG4gIH1cblxuICBpc0ZsYXNoRGF0YShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmlzTG9jYWxEYXRhKGtleSlcbiAgfVxuXG4gIGlzTG9jYWxEYXRhKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19oYXMoa2V5LCBTdG9yYWdlVHlwZS5MT0NBTF9TVE9SQUdFKVxuICB9XG5cbiAgaXNTZXNzaW9uRGF0YShrZXk6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl9faGFzKGtleSwgU3RvcmFnZVR5cGUuU0VTU0lPTl9TVE9SQUdFKVxuICB9XG5cbiAgcmVtb3ZlKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmUoa2V5LCBTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSlcbiAgfVxuXG4gIHJlbW92ZVNlc3Npb25EYXRhKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuX19yZW1vdmUoa2V5LCBTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gIH1cblxuICByZW1vdmVMb2NhbERhdGEoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fX3JlbW92ZShrZXksIFN0b3JhZ2VUeXBlLkxPQ0FMX1NUT1JBR0UpXG4gIH1cblxuICByZW1vdmVGbGFzaERhdGEoa2V5OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5yZW1vdmVMb2NhbERhdGEoa2V5KVxuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICB0aGlzLl9fZGVzdHJveShTdG9yYWdlVHlwZS5NRU1PUllfU1RPUkFHRSlcbiAgfVxuXG4gIGRlc3Ryb3lMb2NhbERhdGEoKSB7XG4gICAgdGhpcy5fX2Rlc3Ryb3koU3RvcmFnZVR5cGUuTE9DQUxfU1RPUkFHRSlcbiAgfVxuXG4gIGRlc3Ryb3lTZXNzaW9uRGF0YSgpIHtcbiAgICB0aGlzLl9fZGVzdHJveShTdG9yYWdlVHlwZS5TRVNTSU9OX1NUT1JBR0UpXG4gIH1cblxuICBkZXN0cm95QWxsKCkge1xuICAgIHRoaXMuX19kZXN0cm95KFN0b3JhZ2VUeXBlLkRFU1RST1lfQUxMKVxuICB9XG5cbiAgaW5jcmVtZW50KGtleTogc3RyaW5nLCB0aHJvd0lmTm90Zm91bmQgPSBmYWxzZSkge1xuICAgIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0aGlzLmR5bmFtaWNDb25maWcsIGtleSkpIHtcbiAgICAgIGlmICh0eXBlb2YgTnVtYmVyLnBhcnNlSW50KHRoaXMuZHluYW1pY0NvbmZpZ1trZXldKSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgKyt0aGlzLmR5bmFtaWNDb25maWdba2V5XVxuICAgICAgICByZXR1cm4gdGhpcy5keW5hbWljQ29uZmlnW2tleV1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNwZWNpZmllZCBrZXkgaXMgbm90IGEgbnVtYmVyIGNhbid0IGluY3JlbWVudFwiKVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhyb3dJZk5vdGZvdW5kKSB0aHJvdyBuZXcgRXJyb3IoJ0tleSBub3QgZm91bmQnKVxuICAgIH1cbiAgICByZXR1cm4gKHRoaXMuZHluYW1pY0NvbmZpZ1trZXldID0gMSlcbiAgfVxuXG4gIGRlY3JlbWVudChrZXk6IHN0cmluZywgdGhyb3dJZk5vdGZvdW5kID0gZmFsc2UpIHtcbiAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodGhpcy5keW5hbWljQ29uZmlnLCBrZXkpKSB7XG4gICAgICBpZiAodHlwZW9mIE51bWJlci5wYXJzZUludCh0aGlzLmR5bmFtaWNDb25maWdba2V5XSkgPT09ICdudW1iZXInKSB7XG4gICAgICAgIC0tdGhpcy5keW5hbWljQ29uZmlnW2tleV1cbiAgICAgICAgcmV0dXJuIHRoaXMuZHluYW1pY0NvbmZpZ1trZXldXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTcGVjaWZpZWQga2V5IGlzIG5vdCBhIG51bWJlciBjYW4ndCBkZWNyZW1lbnRcIilcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRocm93SWZOb3Rmb3VuZCkgdGhyb3cgbmV3IEVycm9yKCdLZXkgbm90IGZvdW5kJylcbiAgICB9XG4gICAgcmV0dXJuICh0aGlzLmR5bmFtaWNDb25maWdba2V5XSA9IC0xKVxuICB9XG5cbiAgc3RhdGljIHBhcnNlID0gKHZhbHVlOiBzdHJpbmcgfCBudWxsKSA9PiB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YWx1ZSA9IGF0b2IodmFsdWUpXG4gICAgICB9IGNhdGNoIChfZXJyKSB7XG4gICAgICAgIC8qIGVtcHR5ICovXG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICB2YWx1ZSA9IEpTT04ucGFyc2UodmFsdWUpXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvKiBlbXB0eSAqL1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmFsdWVcbiAgfVxuXG4gIHN0YXRpYyBzdHJpbmdpZnkgPSAodmFsdWU6IHN0cmluZyB8IElBbnlPYmplY3QpID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgIHZhbHVlID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoX2Vycikge1xuICAgICAgLyogZW1wdHkgKi9cbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgdmFsdWUgPSBidG9hKHZhbHVlIGFzIHN0cmluZylcbiAgICB9IGNhdGNoIChfZXJyKSB7XG4gICAgICAvKiBlbXB0eSAqL1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZVxuICB9XG59XG5cbmNvbnN0IFNoYXJlZENvbmZpZyA9IG5ldyBHbG9iYWxDb25maWcoKVxuXG5leHBvcnQgZGVmYXVsdCBTaGFyZWRDb25maWdcbiJdfQ==